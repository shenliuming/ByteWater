<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MySQLäº‹åŠ¡æœºåˆ¶å·¥ä½œæµæ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .workflow-container {
            padding: 30px;
        }

        .workflow-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .workflow-title {
            font-size: 2em;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .workflow-subtitle {
            color: #6c757d;
            font-size: 1.1em;
        }

        .progress-bar {
            background: #e9ecef;
            height: 8px;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #28a745, #20c997);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
            position: relative;
        }

        .step-indicator::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: #e9ecef;
            z-index: 1;
        }

        .step {
            background: white;
            border: 3px solid #e9ecef;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #6c757d;
            position: relative;
            z-index: 2;
            transition: all 0.3s ease;
        }

        .step.completed {
            background: #28a745;
            border-color: #28a745;
            color: white;
        }

        .step.active {
            background: #007bff;
            border-color: #007bff;
            color: white;
            transform: scale(1.2);
        }

        .step-content {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            border-left: 5px solid #007bff;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .step-title {
            font-size: 1.5em;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .step-description {
            color: #6c757d;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .demo-area {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e9ecef;
        }

        .sql-windows {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .sql-window {
            background: #2d3748;
            border-radius: 10px;
            padding: 20px;
            color: white;
            font-family: 'Courier New', monospace;
        }

        .window-title {
            background: #4a5568;
            color: white;
            padding: 10px 15px;
            border-radius: 5px 5px 0 0;
            margin: -20px -20px 15px -20px;
            font-weight: bold;
        }

        .sql-command {
            background: #1a202c;
            border: 1px solid #4a5568;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            color: #e2e8f0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
        }

        .sql-result {
            background: #2d3748;
            border: 1px solid #4a5568;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            color: #68d391;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
        }

        .account-status {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #e9ecef;
        }

        .account-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }

        .account-table th,
        .account-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #dee2e6;
        }

        .account-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #495057;
        }

        .account-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .balance-change {
            transition: all 0.5s ease;
        }

        .balance-increase {
            background: #d4edda !important;
            color: #155724;
        }

        .balance-decrease {
            background: #f8d7da !important;
            color: #721c24;
        }

        /* éš”ç¦»çº§åˆ«ä¿¡æ¯æ ·å¼ */
        .isolation-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .isolation-sessions {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }

        .session-info {
            flex: 1;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
        }

        .session-info h4 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 14px;
        }

        /* é”çŠ¶æ€æ ·å¼ */
        #lock-alice, #lock-bob {
            font-weight: bold;
        }

        .lock-held {
            color: #dc3545;
            background: #f8d7da;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .lock-waiting {
            color: #856404;
            background: #fff3cd;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .lock-free {
            color: #155724;
            background: #d4edda;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .control-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #28a745;
            text-align: center;
        }

        .control-button {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .control-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .reset-button {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .reset-button:hover {
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

        .highlight-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            color: #856404;
        }

        .success-box {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            color: #155724;
        }

        .error-box {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            color: #721c24;
        }

        .scenario-selector {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #007bff;
        }

        .scenario-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            margin: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .scenario-button:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }

        .scenario-button.active {
            background: #28a745;
        }

        /* è¯»ç°è±¡å¯¹æ¯”è¡¨æ ¼æ ·å¼ */
        .read-phenomena-table {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .read-phenomena-table h4 {
            margin: 0 0 15px 0;
            color: #495057;
            font-size: 16px;
            text-align: center;
        }

        .read-phenomena-table table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .read-phenomena-table th {
            background-color: #6c757d;
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            font-size: 13px;
        }

        .read-phenomena-table td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #dee2e6;
            font-size: 12px;
        }

        .read-phenomena-table tr:last-child td {
            border-bottom: none;
        }

        .read-phenomena-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .read-phenomena-table .problem {
            color: #dc3545;
            font-weight: 600;
        }

        .read-phenomena-table .good {
            color: #28a745;
            font-weight: 600;
        }

        .read-phenomena-table .medium {
            color: #ffc107;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .sql-windows {
                grid-template-columns: 1fr;
            }
            
            .control-button {
                display: block;
                margin: 10px auto;
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>MySQLäº‹åŠ¡æœºåˆ¶å·¥ä½œæµæ¼”ç¤º</h1>
            <p>é€šè¿‡é“¶è¡Œè½¬è´¦åœºæ™¯ï¼Œä¸€æ­¥æ­¥ç†è§£äº‹åŠ¡çš„ACIDç‰¹æ€§</p>
        </div>

        <div class="workflow-container">
            <!-- åœºæ™¯é€‰æ‹©å™¨ -->
            <div class="scenario-selector">
                <h3>é€‰æ‹©æ¼”ç¤ºåœºæ™¯ï¼š</h3>
                <button class="scenario-button active" onclick="selectScenario('normal')">æ­£å¸¸è½¬è´¦</button>
                <button class="scenario-button" onclick="selectScenario('rollback')">è½¬è´¦å¤±è´¥å›æ»š</button>
                <button class="scenario-button" onclick="selectScenario('isolation')">éš”ç¦»çº§åˆ«å¯¹æ¯”</button>
                <button class="scenario-button" onclick="selectScenario('deadlock')">æ­»é”æ¼”ç¤º - ç»å…¸å¾ªç¯ç­‰å¾…</button>
                <button class="scenario-button" onclick="selectScenario('deadlock2')">æ­»é”æ¼”ç¤º - æ’å…¥æ„å‘é”</button>
                <button class="scenario-button" onclick="selectScenario('deadlock3')">æ­»é”æ¼”ç¤º - é—´éš™é”å†²çª</button>
            </div>

            <!-- å·¥ä½œæµæ ‡é¢˜ -->
            <div class="workflow-header">
                <h2 class="workflow-title" id="workflow-title">æ­£å¸¸è½¬è´¦æµç¨‹æ¼”ç¤º</h2>
                <p class="workflow-subtitle" id="workflow-subtitle">æ¼”ç¤ºäº‹åŠ¡çš„åŸå­æ€§å’Œä¸€è‡´æ€§ä¿è¯</p>
            </div>

            <!-- è¿›åº¦æ¡ -->
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>

            <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
            <div class="step-indicator" id="step-indicator">
                <div class="step active" id="step-1">1</div>
                <div class="step" id="step-2">2</div>
                <div class="step" id="step-3">3</div>
                <div class="step" id="step-4">4</div>
                <div class="step" id="step-5">5</div>
            </div>

            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="control-panel">
                <button class="control-button" id="prev-button" onclick="prevStep()" disabled>ä¸Šä¸€æ­¥</button>
                <button class="control-button" id="next-button" onclick="nextStep()">ä¸‹ä¸€æ­¥</button>
                <button class="control-button reset-button" onclick="resetDemo()">é‡ç½®æ¼”ç¤º</button>
            </div>

            <!-- å½“å‰æ­¥éª¤å†…å®¹ -->
            <div class="step-content" id="step-content">
                <!-- æ­¥éª¤å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <!-- è´¦æˆ·çŠ¶æ€æ˜¾ç¤º -->
            <div class="account-status">
                <h3>ğŸ’° è´¦æˆ·çŠ¶æ€</h3>
                <table class="account-table">
                    <thead>
                        <tr>
                            <th>è´¦æˆ·å</th>
                            <th>è´¦æˆ·å·</th>
                            <th>ä½™é¢</th>
                            <th>çŠ¶æ€</th>
                            <th>é”çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody id="account-tbody">
                        <tr id="account-alice">
                            <td>Alice</td>
                            <td>1001</td>
                            <td class="balance" id="balance-alice">Â¥10,000.00</td>
                            <td id="status-alice">æ­£å¸¸</td>
                            <td id="lock-alice">æ— é”</td>
                        </tr>
                        <tr id="account-bob">
                            <td>Bob</td>
                            <td>1002</td>
                            <td class="balance" id="balance-bob">Â¥5,000.00</td>
                            <td id="status-bob">æ­£å¸¸</td>
                            <td id="lock-bob">æ— é”</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- éš”ç¦»çº§åˆ«ä¿¡æ¯æ˜¾ç¤º -->
            <div class="isolation-info" id="isolation-info" style="display: none;">
                <h3>ğŸ”’ éš”ç¦»çº§åˆ«ä¿¡æ¯</h3>
                <div class="isolation-sessions">
                    <div class="session-info">
                        <h4>ä¼šè¯A (READ COMMITTED)</h4>
                        <div id="session-a-value">ä½™é¢: Â¥10,000.00</div>
                    </div>
                    <div class="session-info">
                        <h4>ä¼šè¯B (REPEATABLE READ)</h4>
                        <div id="session-b-value">ä½™é¢: Â¥10,000.00</div>
                    </div>
                </div>
                
                <div class="read-phenomena-table">
                    <h4>è¯»ç°è±¡å¯¹æ¯”è¡¨</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>éš”ç¦»çº§åˆ«</th>
                                <th>è„è¯»</th>
                                <th>ä¸å¯é‡å¤è¯»</th>
                                <th>å¹»è¯»</th>
                                <th>æ€§èƒ½</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>READ UNCOMMITTED</td>
                                <td class="problem">âœ“ å¯èƒ½</td>
                                <td class="problem">âœ“ å¯èƒ½</td>
                                <td class="problem">âœ“ å¯èƒ½</td>
                                <td class="good">æœ€é«˜</td>
                            </tr>
                            <tr>
                                <td>READ COMMITTED</td>
                                <td class="good">âœ— é¿å…</td>
                                <td class="problem">âœ“ å¯èƒ½</td>
                                <td class="problem">âœ“ å¯èƒ½</td>
                                <td class="good">è¾ƒé«˜</td>
                            </tr>
                            <tr>
                                <td>REPEATABLE READ</td>
                                <td class="good">âœ— é¿å…</td>
                                <td class="good">âœ— é¿å…</td>
                                <td class="problem">âœ“ å¯èƒ½</td>
                                <td class="medium">ä¸­ç­‰</td>
                            </tr>
                            <tr>
                                <td>SERIALIZABLE</td>
                                <td class="good">âœ— é¿å…</td>
                                <td class="good">âœ— é¿å…</td>
                                <td class="good">âœ— é¿å…</td>
                                <td class="problem">æœ€ä½</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentStep = 1;
        let currentScenario = 'normal';
        let maxSteps = 5;

        // åœºæ™¯é…ç½®
        const scenarios = {
            normal: {
                title: 'æ­£å¸¸è½¬è´¦æµç¨‹æ¼”ç¤º',
                subtitle: 'æ¼”ç¤ºäº‹åŠ¡çš„åŸå­æ€§å’Œä¸€è‡´æ€§ä¿è¯',
                steps: [
                    {
                        title: 'ğŸš€ å¼€å§‹äº‹åŠ¡',
                        description: 'å¯åŠ¨ä¸€ä¸ªæ–°çš„æ•°æ®åº“äº‹åŠ¡ï¼Œç¡®ä¿åç»­æ“ä½œçš„åŸå­æ€§ã€‚',
                        sql: 'BEGIN;',
                        result: 'Query OK, 0 rows affected',
                        explanation: 'äº‹åŠ¡å¼€å§‹ï¼Œæ‰€æœ‰åç»­æ“ä½œå°†åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œã€‚'
                    },
                    {
                        title: 'ğŸ” æ£€æŸ¥ä½™é¢',
                        description: 'æŸ¥è¯¢è½¬å‡ºè´¦æˆ·çš„å½“å‰ä½™é¢ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿèµ„é‡‘è¿›è¡Œè½¬è´¦ã€‚',
                        sql: 'SELECT balance FROM accounts WHERE account_id = 1001;',
                        result: '| balance |\n|---------|  \n| 10000.00|',
                        explanation: 'Aliceè´¦æˆ·ä½™é¢å……è¶³ï¼Œå¯ä»¥è¿›è¡Œ1000å…ƒè½¬è´¦ã€‚'
                    },
                    {
                        title: 'ğŸ’¸ æ‰£å‡ä½™é¢',
                        description: 'ä»è½¬å‡ºè´¦æˆ·æ‰£å‡è½¬è´¦é‡‘é¢ã€‚',
                        sql: 'UPDATE accounts SET balance = balance - 1000 WHERE account_id = 1001;',
                        result: 'Query OK, 1 row affected',
                        explanation: 'Aliceè´¦æˆ·ä½™é¢å‡å°‘1000å…ƒï¼Œå½“å‰ä½™é¢9000å…ƒã€‚',
                        balanceChange: { alice: 9000 }
                    },
                    {
                        title: 'ğŸ’° å¢åŠ ä½™é¢',
                        description: 'å‘è½¬å…¥è´¦æˆ·å¢åŠ è½¬è´¦é‡‘é¢ã€‚',
                        sql: 'UPDATE accounts SET balance = balance + 1000 WHERE account_id = 1002;',
                        result: 'Query OK, 1 row affected',
                        explanation: 'Bobè´¦æˆ·ä½™é¢å¢åŠ 1000å…ƒï¼Œå½“å‰ä½™é¢6000å…ƒã€‚',
                        balanceChange: { bob: 6000 }
                    },
                    {
                        title: 'âœ… æäº¤äº‹åŠ¡',
                        description: 'æäº¤äº‹åŠ¡ï¼Œä½¿æ‰€æœ‰æ›´æ”¹æ°¸ä¹…ç”Ÿæ•ˆã€‚',
                        sql: 'COMMIT;',
                        result: 'Query OK, 0 rows affected',
                        explanation: 'è½¬è´¦æˆåŠŸå®Œæˆï¼æ‰€æœ‰æ›´æ”¹å·²æ°¸ä¹…ä¿å­˜åˆ°æ•°æ®åº“ã€‚'
                    }
                ]
            },
            rollback: {
                title: 'è½¬è´¦å¤±è´¥å›æ»šæ¼”ç¤º',
                subtitle: 'æ¼”ç¤ºäº‹åŠ¡çš„å›æ»šæœºåˆ¶å’Œæ•°æ®ä¸€è‡´æ€§',
                steps: [
                    {
                        title: 'ğŸš€ å¼€å§‹äº‹åŠ¡',
                        description: 'å¯åŠ¨ä¸€ä¸ªæ–°çš„æ•°æ®åº“äº‹åŠ¡ã€‚',
                        sql: 'BEGIN;',
                        result: 'Query OK, 0 rows affected',
                        explanation: 'äº‹åŠ¡å¼€å§‹ï¼Œå‡†å¤‡è¿›è¡Œè½¬è´¦æ“ä½œã€‚'
                    },
                    {
                        title: 'ğŸ’¸ æ‰£å‡ä½™é¢',
                        description: 'ä»è½¬å‡ºè´¦æˆ·æ‰£å‡è½¬è´¦é‡‘é¢ã€‚',
                        sql: 'UPDATE accounts SET balance = balance - 1000 WHERE account_id = 1001;',
                        result: 'Query OK, 1 row affected',
                        explanation: 'Aliceè´¦æˆ·ä½™é¢å‡å°‘1000å…ƒã€‚',
                        balanceChange: { alice: 9000 }
                    },
                    {
                        title: 'âŒ è½¬è´¦å¤±è´¥',
                        description: 'æ¨¡æ‹Ÿè½¬è´¦è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼ˆå¦‚ç½‘ç»œä¸­æ–­ã€ç³»ç»Ÿæ•…éšœç­‰ï¼‰ã€‚',
                        sql: '-- æ¨¡æ‹Ÿç³»ç»Ÿé”™è¯¯\nSELECT 1/0;',
                        result: 'ERROR 1365: Division by zero',
                        explanation: 'è½¬è´¦è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œéœ€è¦å›æ»šäº‹åŠ¡ã€‚'
                    },
                    {
                        title: 'ğŸ”„ å›æ»šäº‹åŠ¡',
                        description: 'ç”±äºé”™è¯¯å‘ç”Ÿï¼Œå›æ»šäº‹åŠ¡ä»¥ä¿æŒæ•°æ®ä¸€è‡´æ€§ã€‚',
                        sql: 'ROLLBACK;',
                        result: 'Query OK, 0 rows affected',
                        explanation: 'äº‹åŠ¡å›æ»šï¼Œæ‰€æœ‰æ›´æ”¹è¢«æ’¤é”€ã€‚',
                        balanceChange: { alice: 10000, bob: 5000 }
                    },
                    {
                        title: 'ğŸ” éªŒè¯å›æ»š',
                        description: 'éªŒè¯è´¦æˆ·ä½™é¢å·²æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ã€‚',
                        sql: 'SELECT account_id, balance FROM accounts WHERE account_id IN (1001, 1002);',
                        result: '| account_id | balance |\n|------------|---------|  \n| 1001       | 10000.00|\n| 1002       | 5000.00 |',
                        explanation: 'æ•°æ®å®Œå…¨æ¢å¤ï¼Œä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§ã€‚'
                    }
                ]
            },
            isolation: {
                title: 'äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸è¯»ç°è±¡æ¼”ç¤º',
                subtitle: 'æ¸…æ™°å±•ç¤ºè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ç­‰å¹¶å‘è¯»å–é—®é¢˜',
                steps: [
                    {
                        title: 'ğŸ“‹ æ¼”ç¤ºæ¦‚è§ˆ',
                        description: 'æœ¬æ¼”ç¤ºå°†å±•ç¤ºå››ç§éš”ç¦»çº§åˆ«å’Œä¸‰ç§è¯»ç°è±¡ã€‚',
                        sql: '-- å››ç§éš”ç¦»çº§åˆ«ï¼š\n-- READ UNCOMMITTED (è„è¯»)\n-- READ COMMITTED (ä¸å¯é‡å¤è¯»)\n-- REPEATABLE READ (å¹»è¯»)\n-- SERIALIZABLE (æ— å¹¶å‘é—®é¢˜)',
                        result: 'å‡†å¤‡æ¼”ç¤ºç¯å¢ƒ',
                        explanation: 'æˆ‘ä»¬å°†é€ä¸€æ¼”ç¤ºè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ç°è±¡ï¼Œä»¥åŠå„éš”ç¦»çº§åˆ«å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ã€‚'
                    },
                    {
                        title: 'ğŸ’€ è„è¯»æ¼”ç¤º - READ UNCOMMITTED',
                        description: 'æ¼”ç¤ºREAD UNCOMMITTEDçº§åˆ«ä¸‹çš„è„è¯»ç°è±¡ã€‚',
                        sql: '-- ä¼šè¯A (READ UNCOMMITTED)\nSET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;\nBEGIN;\nSELECT balance FROM accounts WHERE account_id = 1001;',
                        result: 'Aliceä½™é¢: 10000.00',
                        explanation: 'ä¼šè¯Aè®¾ç½®ä¸ºREAD UNCOMMITTEDçº§åˆ«ï¼Œè¯»å–Aliceåˆå§‹ä½™é¢ã€‚'
                    },
                    {
                        title: 'âœï¸ æœªæäº¤çš„ä¿®æ”¹',
                        description: 'ä¼šè¯Bä¿®æ”¹æ•°æ®ä½†ä¸æäº¤ã€‚',
                        sql: '-- ä¼šè¯B\nBEGIN;\nUPDATE accounts SET balance = 5000 WHERE account_id = 1001;\n-- æ³¨æ„ï¼šæœªæäº¤ï¼',
                        result: 'ä¿®æ”¹æˆåŠŸï¼Œä½†æœªæäº¤',
                        explanation: 'ä¼šè¯Bå°†Aliceä½™é¢æ”¹ä¸º5000ï¼Œä½†äº‹åŠ¡æœªæäº¤ï¼Œæ•°æ®å¤„äºæœªç¡®å®šçŠ¶æ€ã€‚',
                        balanceChange: { alice: 5000 }
                    },
                    {
                        title: 'ğŸ‘» è„è¯»å‘ç”Ÿï¼',
                        description: 'ä¼šè¯Aè¯»å–åˆ°æœªæäº¤çš„æ•°æ®ã€‚',
                        sql: '-- ä¼šè¯A (READ UNCOMMITTED)\nSELECT balance FROM accounts WHERE account_id = 1001;',
                        result: 'Aliceä½™é¢: 5000.00 âš ï¸ è„è¯»ï¼',
                        explanation: 'ğŸš¨ è„è¯»ç°è±¡ï¼šREAD UNCOMMITTEDè¯»å–åˆ°äº†æœªæäº¤çš„æ•°æ®ï¼è¿™æ˜¯æœ€å±é™©çš„è¯»å–ã€‚'
                    },
                    {
                        title: 'ğŸ”„ è„è¯»çš„å±é™©',
                        description: 'ä¼šè¯Bå›æ»šï¼Œè„è¯»çš„æ•°æ®æ¶ˆå¤±ã€‚',
                        sql: '-- ä¼šè¯B\nROLLBACK;\n-- ä¼šè¯Aå†æ¬¡è¯»å–\nSELECT balance FROM accounts WHERE account_id = 1001;',
                        result: 'Aliceä½™é¢: 10000.00 (å›åˆ°åŸå€¼)',
                        explanation: 'ğŸ’¥ è„è¯»å±é™©ï¼šåŸºäº5000ä½™é¢çš„ä¸šåŠ¡å†³ç­–æ˜¯é”™è¯¯çš„ï¼æ•°æ®åˆå˜å›10000äº†ã€‚',
                        balanceChange: { alice: 10000 }
                    },
                    {
                        title: 'ğŸ”„ ä¸å¯é‡å¤è¯»æ¼”ç¤º - READ COMMITTED',
                        description: 'æ¼”ç¤ºREAD COMMITTEDçº§åˆ«ä¸‹çš„ä¸å¯é‡å¤è¯»ã€‚',
                        sql: '-- ä¼šè¯C (READ COMMITTED)\nSET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;\nBEGIN;\nSELECT balance FROM accounts WHERE account_id = 1001;',
                        result: 'Aliceä½™é¢: 10000.00',
                        explanation: 'ä¼šè¯Cè®¾ç½®ä¸ºREAD COMMITTEDï¼Œé¿å…è„è¯»ï¼Œä½†å¯èƒ½å‡ºç°ä¸å¯é‡å¤è¯»ã€‚'
                    },
                    {
                        title: 'âœ… å…¶ä»–äº‹åŠ¡æäº¤ä¿®æ”¹',
                        description: 'ä¼šè¯Dä¿®æ”¹æ•°æ®å¹¶æäº¤ã€‚',
                        sql: '-- ä¼šè¯D\nBEGIN;\nUPDATE accounts SET balance = 8000 WHERE account_id = 1001;\nCOMMIT;',
                        result: 'ä¿®æ”¹å¹¶æäº¤æˆåŠŸ',
                        explanation: 'ä¼šè¯Då°†Aliceä½™é¢æ”¹ä¸º8000å¹¶æäº¤ï¼Œæ•°æ®å·²ç¡®å®šç”Ÿæ•ˆã€‚',
                        balanceChange: { alice: 8000 }
                    },
                    {
                        title: 'ğŸ”„ ä¸å¯é‡å¤è¯»å‘ç”Ÿï¼',
                        description: 'ä¼šè¯Cåœ¨åŒä¸€äº‹åŠ¡ä¸­å†æ¬¡è¯»å–ï¼Œç»“æœä¸åŒã€‚',
                        sql: '-- ä¼šè¯C (åŒä¸€äº‹åŠ¡å†…)\nSELECT balance FROM accounts WHERE account_id = 1001;',
                        result: 'Aliceä½™é¢: 8000.00 âš ï¸ ä¸å¯é‡å¤è¯»ï¼',
                        explanation: 'ğŸš¨ ä¸å¯é‡å¤è¯»ï¼šåŒä¸€äº‹åŠ¡å†…ä¸¤æ¬¡è¯»å–åŒä¸€è¡Œï¼Œç»“æœä¸åŒï¼ä»10000å˜æˆ8000ã€‚'
                    },
                    {
                        title: 'ğŸ‘» å¹»è¯»æ¼”ç¤º - REPEATABLE READ',
                        description: 'æ¼”ç¤ºREPEATABLE READçº§åˆ«ä¸‹çš„å¹»è¯»ç°è±¡ã€‚',
                        sql: '-- ä¼šè¯E (REPEATABLE READ)\nSET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;\nBEGIN;\nSELECT COUNT(*) FROM accounts WHERE balance > 5000;',
                        result: 'ç¬¦åˆæ¡ä»¶çš„è®°å½•æ•°: 2',
                        explanation: 'ä¼šè¯Eè®¾ç½®ä¸ºREPEATABLE READï¼Œé¿å…ä¸å¯é‡å¤è¯»ï¼Œä½†å¯èƒ½å‡ºç°å¹»è¯»ã€‚'
                    },
                    {
                        title: 'â• æ’å…¥æ–°è®°å½•',
                        description: 'ä¼šè¯Fæ’å…¥æ–°çš„è´¦æˆ·è®°å½•ã€‚',
                        sql: '-- ä¼šè¯F\nBEGIN;\nINSERT INTO accounts (account_id, account_name, balance) \nVALUES (1003, \'Charlie\', 12000);\nCOMMIT;',
                        result: 'æ’å…¥æˆåŠŸ',
                        explanation: 'ä¼šè¯Fæ’å…¥Charlieè´¦æˆ·ï¼Œä½™é¢12000ï¼Œæ»¡è¶³balance > 5000æ¡ä»¶ã€‚'
                    },
                    {
                        title: 'ğŸ‘» å¹»è¯»å‘ç”Ÿï¼',
                        description: 'ä¼šè¯Eå†æ¬¡æ‰§è¡Œç›¸åŒæŸ¥è¯¢ï¼Œç»“æœé›†å˜åŒ–ã€‚',
                        sql: '-- ä¼šè¯E (åŒä¸€äº‹åŠ¡å†…)\nSELECT COUNT(*) FROM accounts WHERE balance > 5000;',
                        result: 'ç¬¦åˆæ¡ä»¶çš„è®°å½•æ•°: 3 âš ï¸ å¹»è¯»ï¼',
                        explanation: 'ğŸš¨ å¹»è¯»ç°è±¡ï¼šåŒä¸€äº‹åŠ¡å†…ç›¸åŒæŸ¥è¯¢ï¼Œç»“æœé›†è¡Œæ•°å˜åŒ–ï¼ä»2æ¡å˜æˆ3æ¡è®°å½•ã€‚'
                    },
                    {
                        title: 'ğŸ”’ SERIALIZABLE - å®Œå…¨éš”ç¦»',
                        description: 'æ¼”ç¤ºSERIALIZABLEçº§åˆ«å®Œå…¨é¿å…å¹¶å‘é—®é¢˜ã€‚',
                        sql: '-- ä¼šè¯G (SERIALIZABLE)\nSET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;\nBEGIN;\nSELECT * FROM accounts WHERE balance > 5000;',
                        result: '3æ¡è®°å½•ï¼Œå®Œå…¨é”å®š',
                        explanation: 'SERIALIZABLEçº§åˆ«é€šè¿‡é”æœºåˆ¶å®Œå…¨é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ã€‚'
                    },
                    {
                        title: 'âš¡ SERIALIZABLEçš„ä»£ä»·',
                        description: 'å…¶ä»–äº‹åŠ¡è¢«å®Œå…¨é˜»å¡ã€‚',
                        sql: '-- ä¼šè¯Hå°è¯•ä¿®æ”¹\nBEGIN;\nUPDATE accounts SET balance = 9000 WHERE account_id = 1001;',
                        result: 'ç­‰å¾…ä¸­... (è¢«SERIALIZABLEé˜»å¡)',
                        explanation: 'âš–ï¸ SERIALIZABLEä»£ä»·ï¼šæœ€é«˜ä¸€è‡´æ€§ï¼Œä½†å¹¶å‘æ€§èƒ½æœ€ä½ï¼Œå…¶ä»–äº‹åŠ¡è¢«é˜»å¡ã€‚'
                    },
                    {
                        title: 'ğŸ“Š æ€»ç»“å¯¹æ¯”',
                        description: 'å››ç§éš”ç¦»çº§åˆ«çš„è¯»ç°è±¡å¯¹æ¯”æ€»ç»“ã€‚',
                        sql: '-- éš”ç¦»çº§åˆ«å¯¹æ¯”ï¼š\n-- READ UNCOMMITTED: è„è¯» âœ“ ä¸å¯é‡å¤è¯» âœ“ å¹»è¯» âœ“\n-- READ COMMITTED:   è„è¯» âœ— ä¸å¯é‡å¤è¯» âœ“ å¹»è¯» âœ“\n-- REPEATABLE READ:  è„è¯» âœ— ä¸å¯é‡å¤è¯» âœ— å¹»è¯» âœ“\n-- SERIALIZABLE:     è„è¯» âœ— ä¸å¯é‡å¤è¯» âœ— å¹»è¯» âœ—',
                        result: 'æ¼”ç¤ºå®Œæˆ',
                        explanation: 'âœ… éš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œè¯»ç°è±¡è¶Šå°‘ï¼Œä½†æ€§èƒ½ä»£ä»·è¶Šå¤§ã€‚å®é™…åº”ç”¨éœ€è¦æƒè¡¡ä¸€è‡´æ€§å’Œæ€§èƒ½ã€‚'
                    }
                ]
            },
            deadlock: {
                title: 'æ­»é”äº§ç”Ÿä¸æ£€æµ‹æ¼”ç¤º',
                subtitle: 'æ¼”ç¤ºæ­»é”çš„äº§ç”Ÿè¿‡ç¨‹å’ŒMySQLçš„è‡ªåŠ¨æ£€æµ‹æœºåˆ¶',
                steps: [
                    {
                        title: 'ğŸš€ å¼€å§‹ä¸¤ä¸ªäº‹åŠ¡',
                        description: 'åœ¨ä¸¤ä¸ªä¼šè¯ä¸­åŒæ—¶å¼€å§‹äº‹åŠ¡ï¼Œå‡†å¤‡æ¼”ç¤ºæ­»é”ã€‚',
                        sql: '-- ä¼šè¯A\nBEGIN;\n-- ä¼šè¯B\nBEGIN;',
                        result: 'Query OK, 0 rows affected (2 sessions)',
                        explanation: 'ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶å¼€å§‹ï¼Œå‡†å¤‡è¿›è¡Œå¯èƒ½å¯¼è‡´æ­»é”çš„æ“ä½œã€‚'
                    },
                    {
                        title: 'ğŸ”’ äº‹åŠ¡Aé”å®šAlice',
                        description: 'äº‹åŠ¡Aæ›´æ–°Aliceçš„è´¦æˆ·ï¼Œè·å¾—è¡Œé”ã€‚',
                        sql: '-- ä¼šè¯A\nUPDATE accounts SET balance = balance - 500 WHERE account_id = 1001;',
                        result: 'Query OK, 1 row affected',
                        explanation: 'äº‹åŠ¡AæˆåŠŸè·å¾—Aliceè´¦æˆ·çš„æ’ä»–é”ã€‚',
                        balanceChange: { alice: 9500 },
                        lockInfo: { alice: 'A' }
                    },
                    {
                        title: 'ğŸ”’ äº‹åŠ¡Bé”å®šBob',
                        description: 'äº‹åŠ¡Bæ›´æ–°Bobçš„è´¦æˆ·ï¼Œè·å¾—è¡Œé”ã€‚',
                        sql: '-- ä¼šè¯B\nUPDATE accounts SET balance = balance - 300 WHERE account_id = 1002;',
                        result: 'Query OK, 1 row affected',
                        explanation: 'äº‹åŠ¡BæˆåŠŸè·å¾—Bobè´¦æˆ·çš„æ’ä»–é”ã€‚',
                        balanceChange: { bob: 4700 },
                        lockInfo: { bob: 'B' }
                    },
                    {
                        title: 'â³ äº‹åŠ¡Aç­‰å¾…Bobé”',
                        description: 'äº‹åŠ¡Aå°è¯•æ›´æ–°Bobè´¦æˆ·ï¼Œä½†éœ€è¦ç­‰å¾…äº‹åŠ¡Bé‡Šæ”¾é”ã€‚',
                        sql: '-- ä¼šè¯A\nUPDATE accounts SET balance = balance + 500 WHERE account_id = 1002;',
                        result: 'ç­‰å¾…ä¸­... (Lock wait timeout)',
                        explanation: 'äº‹åŠ¡Aè¢«é˜»å¡ï¼Œç­‰å¾…äº‹åŠ¡Bé‡Šæ”¾Bobè´¦æˆ·çš„é”ã€‚',
                        lockInfo: { alice: 'A', bob: 'B', waitA: 'Bob' }
                    },
                    {
                        title: 'ğŸ’€ æ­»é”äº§ç”Ÿ',
                        description: 'äº‹åŠ¡Bå°è¯•æ›´æ–°Aliceè´¦æˆ·ï¼Œå½¢æˆæ­»é”ã€‚',
                        sql: '-- ä¼šè¯B\nUPDATE accounts SET balance = balance + 300 WHERE account_id = 1001;',
                        result: 'ERROR 1213: Deadlock found when trying to get lock',
                        explanation: 'æ­»é”æ£€æµ‹ï¼äº‹åŠ¡Bè¢«å›æ»šï¼Œäº‹åŠ¡Aç»§ç»­æ‰§è¡Œã€‚',
                        balanceChange: { alice: 9500, bob: 5000 },
                        lockInfo: { alice: 'A' }
                    },
                    {
                        title: 'ğŸ”„ æ­»é”è§£å†³',
                        description: 'MySQLè‡ªåŠ¨å›æ»šäº‹åŠ¡Bï¼Œäº‹åŠ¡Aå®Œæˆæ“ä½œå¹¶æäº¤ã€‚',
                        sql: '-- äº‹åŠ¡Aç»§ç»­\nCOMMIT;\n-- äº‹åŠ¡Bå·²è¢«å›æ»š',
                        result: 'Query OK, 0 rows affected',
                        explanation: 'æ­»é”è‡ªåŠ¨è§£å†³ï¼Œäº‹åŠ¡AæˆåŠŸå®Œæˆï¼Œäº‹åŠ¡Bè¢«å›æ»šã€‚',
                        balanceChange: { alice: 9500, bob: 5500 },
                        lockInfo: {}
                    }
                ]
            },
            deadlock2: {
                title: 'æ­»é”æ¼”ç¤º - æ’å…¥æ„å‘é”',
                subtitle: 'æ¼”ç¤ºæ’å…¥æ„å‘é”å¯¼è‡´çš„æ­»é”åœºæ™¯',
                steps: [
                    {
                        title: 'ğŸ—ï¸ å‡†å¤‡æµ‹è¯•ç¯å¢ƒ',
                        description: 'åˆ›å»ºå¸¦æœ‰å”¯ä¸€ç´¢å¼•çš„æµ‹è¯•è¡¨ã€‚',
                        sql: 'CREATE TABLE test_insert (\n  id INT PRIMARY KEY,\n  name VARCHAR(50),\n  UNIQUE KEY uk_name (name)\n);\nINSERT INTO test_insert VALUES (1, \'Alice\'), (10, \'Bob\');',
                        result: 'Query OK, 2 rows affected',
                        explanation: 'åˆ›å»ºæµ‹è¯•è¡¨ï¼ŒåŒ…å«ä¸»é”®å’Œå”¯ä¸€ç´¢å¼•ï¼Œä¸ºæ’å…¥æ„å‘é”æ¼”ç¤ºåšå‡†å¤‡ã€‚'
                    },
                    {
                        title: 'ğŸ”’ äº‹åŠ¡Aè·å–é—´éš™é”',
                        description: 'äº‹åŠ¡AæŸ¥è¯¢ä¸å­˜åœ¨çš„è®°å½•ï¼Œè·å–é—´éš™é”ã€‚',
                        sql: '-- ä¼šè¯A\nBEGIN;\nSELECT * FROM test_insert WHERE id = 5 FOR UPDATE;',
                        result: 'Empty set (è·å–é—´éš™é”: (1,10))',
                        explanation: 'äº‹åŠ¡Aåœ¨id=5ä½ç½®è·å–é—´éš™é”ï¼Œé”å®š(1,10)åŒºé—´ã€‚',
                        lockStatus: { alice: 'æŒæœ‰é—´éš™é”(1,10)' }
                    },
                    {
                        title: 'ğŸ”’ äº‹åŠ¡Bè·å–å¦ä¸€ä¸ªé—´éš™é”',
                        description: 'äº‹åŠ¡BæŸ¥è¯¢å¦ä¸€ä¸ªä¸å­˜åœ¨çš„è®°å½•ã€‚',
                        sql: '-- ä¼šè¯B\nBEGIN;\nSELECT * FROM test_insert WHERE id = 8 FOR UPDATE;',
                        result: 'Empty set (è·å–é—´éš™é”: (1,10))',
                        explanation: 'äº‹åŠ¡Bä¹Ÿåœ¨åŒä¸€åŒºé—´è·å–é—´éš™é”ï¼Œé—´éš™é”ä¹‹é—´å…¼å®¹ã€‚',
                        lockStatus: { alice: 'æŒæœ‰é—´éš™é”(1,10)', bob: 'æŒæœ‰é—´éš™é”(1,10)' }
                    },
                    {
                        title: 'âš¡ äº‹åŠ¡Aå°è¯•æ’å…¥',
                        description: 'äº‹åŠ¡Aå°è¯•åœ¨é—´éš™ä¸­æ’å…¥æ•°æ®ã€‚',
                        sql: '-- ä¼šè¯A\nINSERT INTO test_insert VALUES (5, \'Charlie\');',
                        result: 'ç­‰å¾…ä¸­... (éœ€è¦æ’å…¥æ„å‘é”)',
                        explanation: 'äº‹åŠ¡Aéœ€è¦æ’å…¥æ„å‘é”ï¼Œä½†ä¸äº‹åŠ¡Bçš„é—´éš™é”å†²çªï¼Œå¼€å§‹ç­‰å¾…ã€‚',
                        lockStatus: { alice: 'ç­‰å¾…æ’å…¥æ„å‘é”', bob: 'æŒæœ‰é—´éš™é”(1,10)' }
                    },
                    {
                        title: 'ğŸ’¥ äº‹åŠ¡Bå°è¯•æ’å…¥ - æ­»é”ï¼',
                        description: 'äº‹åŠ¡Bä¹Ÿå°è¯•æ’å…¥ï¼Œè§¦å‘æ­»é”æ£€æµ‹ã€‚',
                        sql: '-- ä¼šè¯B\nINSERT INTO test_insert VALUES (8, \'David\');',
                        result: 'ERROR 1213: Deadlock found when trying to get lock',
                        explanation: 'æ­»é”æ£€æµ‹ï¼šAç­‰å¾…Bé‡Šæ”¾é—´éš™é”ï¼ŒBç­‰å¾…Aé‡Šæ”¾é—´éš™é”ï¼Œå½¢æˆå¾ªç¯ç­‰å¾…ï¼',
                        lockStatus: { alice: 'ç­‰å¾…æ’å…¥æ„å‘é”', bob: 'æ­»é”å›æ»š' }
                    },
                    {
                        title: 'âœ… æ¸…ç†å’Œæ€»ç»“',
                        description: 'æ¸…ç†æµ‹è¯•æ•°æ®ï¼Œæ€»ç»“æ’å…¥æ„å‘é”æ­»é”ã€‚',
                        sql: '-- ä¼šè¯A\nCOMMIT;\nDROP TABLE test_insert;',
                        result: 'Query OK, 0 rows affected',
                        explanation: 'æ’å…¥æ„å‘é”æ­»é”ï¼šå¤šä¸ªäº‹åŠ¡æŒæœ‰é—´éš™é”ï¼ŒåŒæ—¶å°è¯•åœ¨åŒä¸€é—´éš™æ’å…¥æ—¶å‘ç”Ÿã€‚'
                    }
                ]
            },
            deadlock3: {
                title: 'æ­»é”æ¼”ç¤º - é—´éš™é”å†²çª',
                subtitle: 'æ¼”ç¤ºé—´éš™é”ä¸è®°å½•é”çš„å¤æ‚æ­»é”åœºæ™¯',
                steps: [
                    {
                        title: 'ğŸ—ï¸ å‡†å¤‡èŒƒå›´æŸ¥è¯¢ç¯å¢ƒ',
                        description: 'å‡†å¤‡ç”¨äºèŒƒå›´æŸ¥è¯¢çš„æµ‹è¯•æ•°æ®ã€‚',
                        sql: 'CREATE TABLE test_range (\n  id INT PRIMARY KEY,\n  status VARCHAR(20),\n  INDEX idx_status (status)\n);\nINSERT INTO test_range VALUES \n(1, \'active\'), (5, \'active\'), (10, \'inactive\'), (15, \'active\');',
                        result: 'Query OK, 4 rows affected',
                        explanation: 'åˆ›å»ºå¸¦ç´¢å¼•çš„æµ‹è¯•è¡¨ï¼Œä¸ºé—´éš™é”æ¼”ç¤ºå‡†å¤‡æ•°æ®ã€‚'
                    },
                    {
                        title: 'ğŸ” äº‹åŠ¡AèŒƒå›´æŸ¥è¯¢',
                        description: 'äº‹åŠ¡Aæ‰§è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œè·å–å¤šä¸ªé—´éš™é”ã€‚',
                        sql: '-- ä¼šè¯A\nBEGIN;\nSELECT * FROM test_range WHERE id BETWEEN 3 AND 12 FOR UPDATE;',
                        result: '2 rows (id=5,10) + é—´éš™é”',
                        explanation: 'äº‹åŠ¡Aè·å–è®°å½•é”(id=5,10)å’Œé—´éš™é”(1,5)ã€(5,10)ã€(10,15)ã€‚',
                        lockStatus: { alice: 'æŒæœ‰è®°å½•é”+é—´éš™é”' }
                    },
                    {
                        title: 'ğŸ” äº‹åŠ¡Bä¸åŒèŒƒå›´æŸ¥è¯¢',
                        description: 'äº‹åŠ¡BæŸ¥è¯¢ä¸åŒä½†é‡å çš„èŒƒå›´ã€‚',
                        sql: '-- ä¼šè¯B\nBEGIN;\nSELECT * FROM test_range WHERE id BETWEEN 8 AND 18 FOR UPDATE;',
                        result: 'ç­‰å¾…ä¸­... (é—´éš™é”å†²çª)',
                        explanation: 'äº‹åŠ¡Béœ€è¦çš„é”ä¸äº‹åŠ¡Açš„é—´éš™é”å†²çªï¼Œå¼€å§‹ç­‰å¾…ã€‚',
                        lockStatus: { alice: 'æŒæœ‰è®°å½•é”+é—´éš™é”', bob: 'ç­‰å¾…é—´éš™é”' }
                    },
                    {
                        title: 'ğŸ”„ äº‹åŠ¡Aå°è¯•æ‰©å±•èŒƒå›´',
                        description: 'äº‹åŠ¡Aå°è¯•æŸ¥è¯¢æ›´å¤§èŒƒå›´ï¼Œéœ€è¦æ›´å¤šé”ã€‚',
                        sql: '-- ä¼šè¯A\nSELECT * FROM test_range WHERE id BETWEEN 1 AND 20 FOR UPDATE;',
                        result: 'ç­‰å¾…ä¸­... (éœ€è¦æ›´å¤šé—´éš™é”)',
                        explanation: 'äº‹åŠ¡Aéœ€è¦è·å–æ›´å¤šé—´éš™é”ï¼Œä½†éƒ¨åˆ†åŒºåŸŸè¢«äº‹åŠ¡Bç”³è¯·ä¸­ã€‚',
                        lockStatus: { alice: 'ç­‰å¾…æ‰©å±•é”èŒƒå›´', bob: 'ç­‰å¾…é—´éš™é”' }
                    },
                    {
                        title: 'ğŸ’¥ æ­»é”æ£€æµ‹è§¦å‘',
                        description: 'MySQLæ£€æµ‹åˆ°é—´éš™é”çš„å¾ªç¯ç­‰å¾…ã€‚',
                        sql: '-- ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹\n-- æ­»é”æ£€æµ‹å™¨è¿è¡Œ',
                        result: 'ERROR 1213: Deadlock found (äº‹åŠ¡Bå›æ»š)',
                        explanation: 'å¤æ‚çš„é—´éš™é”æ­»é”ï¼šAæŒæœ‰é”ç­‰å¾…Bé‡Šæ”¾ï¼ŒBç­‰å¾…Aé‡Šæ”¾ï¼Œå½¢æˆæ­»é”ã€‚',
                        lockStatus: { alice: 'æŒæœ‰è®°å½•é”+é—´éš™é”', bob: 'æ­»é”å›æ»š' }
                    },
                    {
                        title: 'âœ… æ¸…ç†å’Œæ€»ç»“',
                        description: 'æ¸…ç†æµ‹è¯•ç¯å¢ƒï¼Œæ€»ç»“é—´éš™é”æ­»é”ç‰¹ç‚¹ã€‚',
                        sql: '-- ä¼šè¯A\nCOMMIT;\nDROP TABLE test_range;',
                        result: 'Query OK, 0 rows affected',
                        explanation: 'é—´éš™é”æ­»é”ç‰¹ç‚¹ï¼šèŒƒå›´æŸ¥è¯¢é‡å ã€é”ç²’åº¦ç»†ã€æ£€æµ‹å¤æ‚ï¼Œéœ€è¦åˆç†è®¾è®¡æŸ¥è¯¢é¡ºåºã€‚'
                    }
                ]
            }
        };

        // åˆå§‹åŒ–æ¼”ç¤º
        function initDemo() {
            updateStepContent();
            updateProgress();
            updateButtons();
        }

        // é€‰æ‹©åœºæ™¯
        function selectScenario(scenario) {
            currentScenario = scenario;
            currentStep = 1;
            
            // æ›´æ–°åœºæ™¯æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.scenario-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // æ›´æ–°æ ‡é¢˜
            const config = scenarios[scenario];
            document.getElementById('workflow-title').textContent = config.title;
            document.getElementById('workflow-subtitle').textContent = config.subtitle;
            
            // æ˜¾ç¤º/éšè—éš”ç¦»çº§åˆ«ä¿¡æ¯
            const isolationInfo = document.getElementById('isolation-info');
            if (scenario === 'isolation') {
                isolationInfo.style.display = 'block';
            } else {
                isolationInfo.style.display = 'none';
            }
            
            // é‡ç½®è´¦æˆ·ä½™é¢å’Œé”çŠ¶æ€
            resetAccounts();
            
            // æ›´æ–°æ˜¾ç¤º
            updateStepContent();
            updateProgress();
            updateButtons();
            updateStepIndicator();
        }

        // ä¸‹ä¸€æ­¥
        function nextStep() {
            if (currentStep < scenarios[currentScenario].steps.length) {
                currentStep++;
                updateStepContent();
                updateProgress();
                updateButtons();
                updateStepIndicator();
                
                const step = scenarios[currentScenario].steps[currentStep - 1];
                
                // æ›´æ–°è´¦æˆ·ä½™é¢
                if (step.balanceChange) {
                    updateAccountBalance(step.balanceChange);
                }
                
                // æ›´æ–°é”çŠ¶æ€
                if (step.lockInfo) {
                    updateLockStatus(step.lockInfo);
                }
                
                // æ›´æ–°éš”ç¦»çº§åˆ«ä¿¡æ¯
                if (currentScenario === 'isolation') {
                    updateIsolationInfo(step);
                }
            }
        }

        // ä¸Šä¸€æ­¥
        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepContent();
                updateProgress();
                updateButtons();
                updateStepIndicator();
                
                // æ¢å¤è´¦æˆ·ä½™é¢ï¼ˆç®€åŒ–å¤„ç†ï¼‰
                if (currentStep === 1) {
                    resetAccounts();
                }
            }
        }

        // é‡ç½®æ¼”ç¤º
        function resetDemo() {
            currentStep = 1;
            resetAccounts();
            updateStepContent();
            updateProgress();
            updateButtons();
            updateStepIndicator();
        }

        // æ›´æ–°æ­¥éª¤å†…å®¹
        function updateStepContent() {
            const step = scenarios[currentScenario].steps[currentStep - 1];
            const content = document.getElementById('step-content');
            
            content.innerHTML = `
                <div class="step-title">
                    ${step.title}
                </div>
                <div class="step-description">
                    ${step.description}
                </div>
                <div class="demo-area">
                    <div class="sql-windows">
                        <div class="sql-window">
                            <div class="window-title">SQLå‘½ä»¤</div>
                            <div class="sql-command">${step.sql}</div>
                        </div>
                        <div class="sql-window">
                            <div class="window-title">æ‰§è¡Œç»“æœ</div>
                            <div class="sql-result">${step.result}</div>
                        </div>
                    </div>
                    <div class="highlight-box">
                        <strong>è¯´æ˜ï¼š</strong>${step.explanation}
                    </div>
                </div>
            `;
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress() {
            const progress = (currentStep / scenarios[currentScenario].steps.length) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
        }

        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        function updateButtons() {
            const nextBtn = document.getElementById('next-button');
            const prevBtn = document.getElementById('prev-button');
            
            nextBtn.disabled = currentStep >= scenarios[currentScenario].steps.length;
            prevBtn.disabled = currentStep <= 1;
            
            if (nextBtn.disabled) {
                nextBtn.textContent = 'æ¼”ç¤ºå®Œæˆ';
            } else {
                nextBtn.textContent = 'ä¸‹ä¸€æ­¥';
            }
        }

        // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
        function updateStepIndicator() {
            const totalSteps = scenarios[currentScenario].steps.length;
            const indicator = document.getElementById('step-indicator');
            
            // æ¸…ç©ºç°æœ‰æ­¥éª¤
            indicator.innerHTML = '';
            
            // åˆ›å»ºæ­¥éª¤åœ†åœˆ
            for (let i = 1; i <= totalSteps; i++) {
                const step = document.createElement('div');
                step.className = 'step';
                step.textContent = i;
                step.id = `step-${i}`;
                
                if (i < currentStep) {
                    step.classList.add('completed');
                } else if (i === currentStep) {
                    step.classList.add('active');
                }
                
                indicator.appendChild(step);
            }
        }

        // æ›´æ–°è´¦æˆ·ä½™é¢
        function updateAccountBalance(changes) {
            if (changes.alice !== undefined) {
                const aliceBalance = document.getElementById('balance-alice');
                aliceBalance.textContent = `Â¥${changes.alice.toLocaleString()}.00`;
                aliceBalance.classList.add('balance-change');
                if (changes.alice < 10000) {
                    aliceBalance.classList.add('balance-decrease');
                } else {
                    aliceBalance.classList.add('balance-increase');
                }
                setTimeout(() => {
                    aliceBalance.classList.remove('balance-change', 'balance-decrease', 'balance-increase');
                }, 1000);
            }
            
            if (changes.bob !== undefined) {
                const bobBalance = document.getElementById('balance-bob');
                bobBalance.textContent = `Â¥${changes.bob.toLocaleString()}.00`;
                bobBalance.classList.add('balance-change');
                if (changes.bob > 5000) {
                    bobBalance.classList.add('balance-increase');
                } else {
                    bobBalance.classList.add('balance-decrease');
                }
                setTimeout(() => {
                    bobBalance.classList.remove('balance-change', 'balance-decrease', 'balance-increase');
                }, 1000);
            }
        }

        // é‡ç½®è´¦æˆ·ä½™é¢
        function resetAccounts() {
            document.getElementById('balance-alice').textContent = 'Â¥10,000.00';
            document.getElementById('balance-bob').textContent = 'Â¥5,000.00';
            document.getElementById('status-alice').textContent = 'æ­£å¸¸';
            document.getElementById('status-bob').textContent = 'æ­£å¸¸';
            
            // é‡ç½®é”çŠ¶æ€
            const lockAlice = document.getElementById('lock-alice');
            const lockBob = document.getElementById('lock-bob');
            lockAlice.textContent = 'æ— é”';
            lockBob.textContent = 'æ— é”';
            lockAlice.className = 'lock-free';
            lockBob.className = 'lock-free';
            
            // é‡ç½®éš”ç¦»çº§åˆ«ä¿¡æ¯
            document.getElementById('session-a-value').textContent = 'ä½™é¢: Â¥10,000.00';
            document.getElementById('session-b-value').textContent = 'ä½™é¢: Â¥10,000.00';
        }

        // æ›´æ–°é”çŠ¶æ€
        function updateLockStatus(lockInfo) {
            const lockAlice = document.getElementById('lock-alice');
            const lockBob = document.getElementById('lock-bob');
            
            // é‡ç½®é”çŠ¶æ€
            lockAlice.textContent = 'æ— é”';
            lockBob.textContent = 'æ— é”';
            lockAlice.className = 'lock-free';
            lockBob.className = 'lock-free';
            
            // è®¾ç½®é”çŠ¶æ€
            if (lockInfo.alice) {
                lockAlice.textContent = `äº‹åŠ¡${lockInfo.alice}æŒæœ‰`;
                lockAlice.className = 'lock-held';
            }
            if (lockInfo.bob) {
                lockBob.textContent = `äº‹åŠ¡${lockInfo.bob}æŒæœ‰`;
                lockBob.className = 'lock-held';
            }
            if (lockInfo.waitA) {
                lockBob.textContent = `äº‹åŠ¡BæŒæœ‰ï¼ŒAç­‰å¾…`;
                lockBob.className = 'lock-waiting';
            }
        }

        // æ›´æ–°éš”ç¦»çº§åˆ«ä¿¡æ¯
        function updateIsolationInfo(step) {
            if (currentStep === 4) { // äº‹åŠ¡Cä¿®æ”¹æ•°æ®å
                document.getElementById('session-a-value').textContent = 'ä½™é¢: Â¥10,000.00';
                document.getElementById('session-b-value').textContent = 'ä½™é¢: Â¥10,000.00';
            } else if (currentStep === 5) { // å†æ¬¡è¯»å–å¯¹æ¯”
                document.getElementById('session-a-value').textContent = 'ä½™é¢: Â¥8,000.00 (è¯»åˆ°æœ€æ–°å€¼)';
                document.getElementById('session-b-value').textContent = 'ä½™é¢: Â¥10,000.00 (å¿«ç…§è¯»)';
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initDemo);
    </script>
</body>
</html>