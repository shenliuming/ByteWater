<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InnoDBé”æœºåˆ¶å·¥ä½œæµæ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .workflow-container {
            padding: 30px;
        }

        .workflow-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .workflow-title {
            font-size: 2em;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .workflow-subtitle {
            color: #6c757d;
            font-size: 1.1em;
        }

        .progress-bar {
            background: #e9ecef;
            height: 8px;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #28a745, #20c997);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
            position: relative;
        }

        .step-indicator::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: #e9ecef;
            z-index: 1;
        }

        .step {
            background: white;
            border: 3px solid #e9ecef;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #6c757d;
            position: relative;
            z-index: 2;
            transition: all 0.3s ease;
        }

        .step.completed {
            background: #28a745;
            border-color: #28a745;
            color: white;
        }

        .step.active {
            background: #007bff;
            border-color: #007bff;
            color: white;
            transform: scale(1.2);
        }

        .step-content {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            border-left: 5px solid #007bff;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .step-title {
            font-size: 1.5em;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .step-description {
            color: #6c757d;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .demo-area {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e9ecef;
        }

        .locks-visualization {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }

        .index-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #28a745;
        }

        .index-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #28a745;
            margin-bottom: 15px;
            text-align: center;
        }

        .index-row {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            position: relative;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .index-row.record-locked {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .index-row.gap-locked {
            border-color: #ffc107;
            background: #fff3cd;
        }

        .index-row.next-key-locked {
            border-color: #6f42c1;
            background: #e2e3f3;
        }

        .index-row.shared-locked {
            border-color: #17a2b8;
            background: #d1ecf1;
        }

        .index-row.exclusive-locked {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .lock-indicator {
            font-size: 1.2em;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 15px;
            color: white;
        }

        .lock-indicator.record {
            background: #dc3545;
        }

        .lock-indicator.gap {
            background: #ffc107;
            color: #212529;
        }

        .lock-indicator.next-key {
            background: #6f42c1;
        }

        .lock-indicator.shared {
            background: #17a2b8;
        }

        .lock-indicator.exclusive {
            background: #dc3545;
        }

        .lock-legend {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #007bff;
        }

        .legend-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 15px;
            text-align: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 8px;
            background: white;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 10px;
        }

        .legend-color.record {
            background: #dc3545;
        }

        .legend-color.gap {
            background: #ffc107;
        }

        .legend-color.next-key {
            background: #6f42c1;
        }

        .legend-color.shared {
            background: #17a2b8;
        }

        .legend-color.exclusive {
            background: #dc3545;
        }

        .legend-color.nextkey {
            background: #6f42c1;
        }

        .legend-color.deadlock {
            background: #fd7e14;
        }

        .legend-color.deadlock-resolved {
            background: #28a745;
        }

        .legend-color.waiting {
            background: #6c757d;
        }

        .legend-color.intention {
            background: #20c997;
        }

        .legend-color.intention-shared {
            background: #17a2b8;
        }

        .legend-color.intention-exclusive {
            background: #e83e8c;
        }

        .legend-color.table-exclusive {
            background: #dc3545;
        }

        .lock-indicator.nextkey {
            background: #6f42c1;
        }

        .lock-indicator.deadlock {
            background: #fd7e14;
        }

        .lock-indicator.waiting {
            background: #6c757d;
        }

        .index-row.nextkey-locked {
            border-color: #6f42c1;
            background: #e2d9f3;
        }

        .index-row.deadlock-locked {
            border-color: #fd7e14;
            background: #ffeaa7;
        }

        .transaction-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #ffc107;
        }

        .transaction-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #ffc107;
            margin-bottom: 15px;
            text-align: center;
        }

        .transaction-item {
            background: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #6c757d;
            font-family: 'Courier New', monospace;
        }

        .transaction-item.active {
            border-left-color: #007bff;
            background: #d1ecf1;
        }

        .transaction-item.waiting {
            border-left-color: #ffc107;
            background: #fff3cd;
        }

        .transaction-item.completed {
            border-left-color: #28a745;
            background: #d4edda;
        }

        .transaction-item.blocked {
            border-left-color: #dc3545;
            background: #f8d7da;
        }

        .control-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #28a745;
            text-align: center;
        }

        .control-button {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .control-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .reset-button {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .reset-button:hover {
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

        .scenario-selector {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #007bff;
        }

        .scenario-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            margin: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .scenario-button:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }

        .scenario-button.active {
            background: #28a745;
        }

        .highlight-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            color: #856404;
        }

        .success-box {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            color: #155724;
        }

        .error-box {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            color: #721c24;
        }

        .sql-display {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
        }

        .sql-keyword {
            color: #63b3ed;
            font-weight: bold;
        }

        .sql-string {
            color: #68d391;
        }

        .sql-comment {
            color: #a0aec0;
            font-style: italic;
        }

        .gap-visualization {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .gap-item {
            padding: 8px 15px;
            margin: 0 5px;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
            min-width: 60px;
        }

        .gap-item.record {
            background: #dc3545;
            color: white;
        }

        .gap-item.gap {
            background: #ffc107;
            color: #212529;
            border: 2px dashed #f39c12;
        }

        .gap-arrow {
            font-size: 20px;
            color: #6c757d;
            margin: 0 10px;
        }

        @media (max-width: 1200px) {
            .locks-visualization {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .control-button {
                display: block;
                margin: 10px auto;
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>InnoDBé”æœºåˆ¶å·¥ä½œæµæ¼”ç¤º</h1>
            <p>æ·±å…¥ç†è§£è®°å½•é”ã€é—´éš™é”å’ŒNext-Keyé”çš„å·¥ä½œåŸç†</p>
        </div>

        <div class="workflow-container">
            <!-- åœºæ™¯é€‰æ‹©å™¨ -->
            <div class="scenario-selector">
                <h3>é€‰æ‹©æ¼”ç¤ºåœºæ™¯ï¼š</h3>
                <button class="scenario-button active" onclick="selectScenario('record')">è®°å½•é”æ¼”ç¤º</button>
                <button class="scenario-button" onclick="selectScenario('gap')">é—´éš™é”æ¼”ç¤º</button>
                <button class="scenario-button" onclick="selectScenario('nextkey')">ä¸´é”®é”æ¼”ç¤º</button>
                <button class="scenario-button" onclick="selectScenario('deadlock')">æ­»é”æ£€æµ‹æ¼”ç¤º</button>
                <button class="scenario-button" onclick="selectScenario('lockingprocess')">è¯¦ç»†åŠ é”æµç¨‹</button>
            </div>

            <!-- å·¥ä½œæµæ ‡é¢˜ -->
            <div class="workflow-header">
                <h2 class="workflow-title" id="workflow-title">è®°å½•é”æ¼”ç¤º</h2>
                <p class="workflow-subtitle" id="workflow-subtitle">äº†è§£è®°å½•é”å¦‚ä½•é”å®šå…·ä½“çš„ç´¢å¼•è®°å½•</p>
            </div>

            <!-- è¿›åº¦æ¡ -->
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>

            <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
            <div class="step-indicator" id="step-indicator">
                <div class="step active" id="step-1">1</div>
                <div class="step" id="step-2">2</div>
                <div class="step" id="step-3">3</div>
                <div class="step" id="step-4">4</div>
                <div class="step" id="step-5">5</div>
            </div>

            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="control-panel">
                <button class="control-button" id="prev-button" onclick="prevStep()" disabled>ä¸Šä¸€æ­¥</button>
                <button class="control-button" id="next-button" onclick="nextStep()">ä¸‹ä¸€æ­¥</button>
                <button class="control-button reset-button" onclick="resetDemo()">é‡ç½®æ¼”ç¤º</button>
            </div>

            <!-- å½“å‰æ­¥éª¤å†…å®¹ -->
            <div class="step-content" id="step-content">
                <!-- æ­¥éª¤å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <!-- é”å¯è§†åŒ–åŒºåŸŸ -->
            <div class="locks-visualization">
                <!-- ç´¢å¼•ç»“æ„ -->
                <div class="index-container">
                    <div class="index-title">ğŸ“Š ç´¢å¼•ç»“æ„</div>
                    <div id="index-structure">
                        <!-- ç´¢å¼•è¡Œå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- é”å›¾ä¾‹ -->
                <div class="lock-legend">
                    <div class="legend-title">ğŸ”’ é”ç±»å‹å›¾ä¾‹</div>
                    <div id="lock-legend">
                        <!-- å›¾ä¾‹é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <!-- äº‹åŠ¡é¢æ¿ -->
            <div class="transaction-panel">
                <div class="transaction-title">âš¡ äº‹åŠ¡æ‰§è¡ŒçŠ¶æ€</div>
                <div id="transaction-status">
                    <!-- äº‹åŠ¡çŠ¶æ€å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <!-- é—´éš™å¯è§†åŒ–ï¼ˆä»…åœ¨é—´éš™é”å’ŒNext-Keyé”åœºæ™¯æ˜¾ç¤ºï¼‰ -->
            <div class="gap-visualization" id="gap-visualization" style="display: none;">
                <!-- é—´éš™å¯è§†åŒ–å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <!-- ç­‰å¾…å›¾å¯è§†åŒ–ï¼ˆä»…åœ¨æ­»é”åœºæ™¯æ˜¾ç¤ºï¼‰ -->
            <div class="wait-graph" id="wait-graph" style="display: none; background: white; border-radius: 10px; padding: 20px; margin-top: 20px; border: 2px solid #007bff;">
                <!-- ç­‰å¾…å›¾å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <!-- è¡¨çº§é”å¯è§†åŒ–ï¼ˆä»…åœ¨æ„å‘é”åœºæ™¯æ˜¾ç¤ºï¼‰ -->
            <div class="table-locks" id="table-locks" style="display: none; background: white; border-radius: 10px; padding: 20px; margin-top: 20px; border: 2px solid #007bff;">
                <!-- è¡¨çº§é”å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <!-- åŠ é”æ­¥éª¤å¯è§†åŒ–ï¼ˆä»…åœ¨è¯¦ç»†åŠ é”æµç¨‹åœºæ™¯æ˜¾ç¤ºï¼‰ -->
            <div class="locking-steps" id="locking-steps" style="display: none; background: white; border-radius: 10px; padding: 20px; margin-top: 20px; border: 2px solid #28a745;">
                <!-- åŠ é”æ­¥éª¤å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <!-- é”è¡¨å¯è§†åŒ–ï¼ˆä»…åœ¨è¯¦ç»†åŠ é”æµç¨‹åœºæ™¯æ˜¾ç¤ºï¼‰ -->
            <div class="lock-table" id="lock-table" style="display: none; background: white; border-radius: 10px; padding: 20px; margin-top: 20px; border: 2px solid #dc3545;">
                <!-- é”è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>

        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentStep = 1;
        let currentScenario = 'record';

        // åœºæ™¯é…ç½®
        const scenarios = {
            record: {
                title: 'è®°å½•é”æ¼”ç¤º',
                subtitle: 'äº†è§£è®°å½•é”å¦‚ä½•é”å®šå…·ä½“çš„ç´¢å¼•è®°å½•',
                steps: [
                    {
                        title: 'ğŸ“‹ å‡†å¤‡æµ‹è¯•æ•°æ®',
                        description: 'åˆ›å»ºç”¨æˆ·è¡¨å¹¶æ’å…¥æµ‹è¯•æ•°æ®ï¼Œå»ºç«‹ä¸»é”®ç´¢å¼•ã€‚',
                        explanation: 'è®°å½•é”é”å®šçš„æ˜¯ç´¢å¼•è®°å½•ï¼Œè€Œä¸æ˜¯æ•°æ®è¡Œæœ¬èº«ã€‚',
                        indexData: [
                            { id: 1, name: 'å¼ ä¸‰', age: 25, locked: false, lockType: null },
                            { id: 5, name: 'æå››', age: 30, locked: false, lockType: null },
                            { id: 10, name: 'ç‹äº”', age: 35, locked: false, lockType: null },
                            { id: 15, name: 'èµµå…­', age: 40, locked: false, lockType: null }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'CREATE TABLE users (id INT PRIMARY KEY, name VARCHAR(50), age INT)', status: 'completed' },
                            { id: 'T2', sql: 'INSERT INTO users VALUES (1,"å¼ ä¸‰",25), (5,"æå››",30), (10,"ç‹äº”",35), (15,"èµµå…­",40)', status: 'completed' }
                        ],
                        legend: [
                            { type: 'record', name: 'è®°å½•é”', description: 'é”å®šå…·ä½“çš„ç´¢å¼•è®°å½•' }
                        ]
                    },
                    {
                        title: 'ğŸ”’ äº‹åŠ¡Aè·å–æ’ä»–é”',
                        description: 'äº‹åŠ¡Aæ‰§è¡ŒUPDATEè¯­å¥ï¼Œå¯¹id=5çš„è®°å½•åŠ æ’ä»–é”ã€‚',
                        explanation: 'æ’ä»–é”ï¼ˆXé”ï¼‰é˜»æ­¢å…¶ä»–äº‹åŠ¡å¯¹åŒä¸€è®°å½•è¿›è¡Œè¯»å†™æ“ä½œã€‚',
                        indexData: [
                            { id: 1, name: 'å¼ ä¸‰', age: 25, locked: false, lockType: null },
                            { id: 5, name: 'æå››', age: 30, locked: true, lockType: 'exclusive' },
                            { id: 10, name: 'ç‹äº”', age: 35, locked: false, lockType: null },
                            { id: 15, name: 'èµµå…­', age: 40, locked: false, lockType: null }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'BEGIN', status: 'active' },
                            { id: 'T1', sql: 'UPDATE users SET age = 31 WHERE id = 5', status: 'active' }
                        ],
                        legend: [
                            { type: 'exclusive', name: 'æ’ä»–é”(X)', description: 'é˜»æ­¢å…¶ä»–äº‹åŠ¡è¯»å†™' }
                        ]
                    },
                    {
                        title: 'ğŸš« äº‹åŠ¡Bå°è¯•è®¿é—®',
                        description: 'äº‹åŠ¡Bå°è¯•ä¿®æ”¹åŒä¸€è®°å½•ï¼Œè¢«é˜»å¡ç­‰å¾…ã€‚',
                        explanation: 'ç”±äºè®°å½•å·²è¢«æ’ä»–é”é”å®šï¼Œäº‹åŠ¡Bå¿…é¡»ç­‰å¾…äº‹åŠ¡Aé‡Šæ”¾é”ã€‚',
                        indexData: [
                            { id: 1, name: 'å¼ ä¸‰', age: 25, locked: false, lockType: null },
                            { id: 5, name: 'æå››', age: 30, locked: true, lockType: 'exclusive' },
                            { id: 10, name: 'ç‹äº”', age: 35, locked: false, lockType: null },
                            { id: 15, name: 'èµµå…­', age: 40, locked: false, lockType: null }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'UPDATE users SET age = 31 WHERE id = 5', status: 'active' },
                            { id: 'T2', sql: 'BEGIN', status: 'active' },
                            { id: 'T2', sql: 'UPDATE users SET age = 32 WHERE id = 5', status: 'blocked' }
                        ],
                        legend: [
                            { type: 'exclusive', name: 'æ’ä»–é”(X)', description: 'é˜»æ­¢å…¶ä»–äº‹åŠ¡è¯»å†™' }
                        ]
                    },
                    {
                        title: 'âœ… äº‹åŠ¡Aæäº¤',
                        description: 'äº‹åŠ¡Aæäº¤ï¼Œé‡Šæ”¾æ’ä»–é”ã€‚',
                        explanation: 'é”åœ¨äº‹åŠ¡æäº¤æˆ–å›æ»šæ—¶è‡ªåŠ¨é‡Šæ”¾ã€‚',
                        indexData: [
                            { id: 1, name: 'å¼ ä¸‰', age: 25, locked: false, lockType: null },
                            { id: 5, name: 'æå››', age: 31, locked: false, lockType: null },
                            { id: 10, name: 'ç‹äº”', age: 35, locked: false, lockType: null },
                            { id: 15, name: 'èµµå…­', age: 40, locked: false, lockType: null }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'COMMIT', status: 'completed' },
                            { id: 'T2', sql: 'UPDATE users SET age = 32 WHERE id = 5', status: 'waiting' }
                        ],
                        legend: [
                            { type: 'record', name: 'è®°å½•é”', description: 'é”å®šå…·ä½“çš„ç´¢å¼•è®°å½•' }
                        ]
                    },
                    {
                        title: 'ğŸ¯ äº‹åŠ¡Bè·å¾—é”',
                        description: 'äº‹åŠ¡Bè·å¾—é”å¹¶æˆåŠŸæ‰§è¡Œæ›´æ–°æ“ä½œã€‚',
                        explanation: 'è®°å½•é”ç¡®ä¿äº†æ•°æ®çš„ä¸€è‡´æ€§ï¼Œé¿å…äº†å¹¶å‘ä¿®æ”¹å†²çªã€‚',
                        indexData: [
                            { id: 1, name: 'å¼ ä¸‰', age: 25, locked: false, lockType: null },
                            { id: 5, name: 'æå››', age: 32, locked: true, lockType: 'exclusive' },
                            { id: 10, name: 'ç‹äº”', age: 35, locked: false, lockType: null },
                            { id: 15, name: 'èµµå…­', age: 40, locked: false, lockType: null }
                        ],
                        transactions: [
                            { id: 'T2', sql: 'UPDATE users SET age = 32 WHERE id = 5', status: 'active' },
                            { id: 'T2', sql: 'COMMIT', status: 'completed' }
                        ],
                        legend: [
                            { type: 'exclusive', name: 'æ’ä»–é”(X)', description: 'é˜»æ­¢å…¶ä»–äº‹åŠ¡è¯»å†™' }
                        ]
                    }
                ]
            },
            gap: {
                title: 'é—´éš™é”æ¼”ç¤º',
                subtitle: 'äº†è§£é—´éš™é”å¦‚ä½•é˜²æ­¢å¹»è¯»é—®é¢˜',
                steps: [
                    {
                        title: 'ğŸ“‹ å‡†å¤‡æµ‹è¯•æ•°æ®',
                        description: 'åˆ›å»ºç”¨æˆ·è¡¨å¹¶æ’å…¥æµ‹è¯•æ•°æ®ï¼Œæ³¨æ„IDä¹‹é—´çš„é—´éš™ã€‚',
                        explanation: 'é—´éš™é”é”å®šçš„æ˜¯ç´¢å¼•è®°å½•ä¹‹é—´çš„é—´éš™ï¼Œé˜²æ­¢æ–°è®°å½•æ’å…¥ã€‚',
                        indexData: [
                            { id: 1, name: 'å¼ ä¸‰', age: 25, locked: false, lockType: null },
                            { id: 5, name: 'æå››', age: 30, locked: false, lockType: null },
                            { id: 10, name: 'ç‹äº”', age: 35, locked: false, lockType: null },
                            { id: 15, name: 'èµµå…­', age: 40, locked: false, lockType: null }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'CREATE TABLE users (id INT PRIMARY KEY, name VARCHAR(50), age INT)', status: 'completed' },
                            { id: 'T2', sql: 'INSERT INTO users VALUES (1,"å¼ ä¸‰",25), (5,"æå››",30), (10,"ç‹äº”",35), (15,"èµµå…­",40)', status: 'completed' }
                        ],
                        legend: [
                            { type: 'gap', name: 'é—´éš™é”', description: 'é”å®šç´¢å¼•è®°å½•ä¹‹é—´çš„é—´éš™' }
                        ],
                        gaps: [
                            { start: '(-âˆ', end: '1)', locked: false },
                            { start: '(1', end: '5)', locked: false },
                            { start: '(5', end: '10)', locked: false },
                            { start: '(10', end: '15)', locked: false },
                            { start: '(15', end: '+âˆ)', locked: false }
                        ]
                    },
                    {
                        title: 'ğŸ” äº‹åŠ¡Aæ‰§è¡ŒèŒƒå›´æŸ¥è¯¢',
                        description: 'äº‹åŠ¡Aæ‰§è¡ŒSELECT ... FOR UPDATEï¼Œé”å®šèŒƒå›´å†…çš„é—´éš™ã€‚',
                        explanation: 'èŒƒå›´æŸ¥è¯¢ä¼šå¯¹æŸ¥è¯¢èŒƒå›´å†…çš„é—´éš™åŠ é”ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥æ–°è®°å½•ã€‚',
                        indexData: [
                            { id: 1, name: 'å¼ ä¸‰', age: 25, locked: false, lockType: null },
                            { id: 5, name: 'æå››', age: 30, locked: false, lockType: null },
                            { id: 10, name: 'ç‹äº”', age: 35, locked: false, lockType: null },
                            { id: 15, name: 'èµµå…­', age: 40, locked: false, lockType: null }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'BEGIN', status: 'active' },
                            { id: 'T1', sql: 'SELECT * FROM users WHERE id > 3 AND id < 12 FOR UPDATE', status: 'active' }
                        ],
                        legend: [
                            { type: 'gap', name: 'é—´éš™é”', description: 'é”å®šç´¢å¼•è®°å½•ä¹‹é—´çš„é—´éš™' }
                        ],
                        gaps: [
                            { start: '(-âˆ', end: '1)', locked: false },
                            { start: '(1', end: '5)', locked: true },
                            { start: '(5', end: '10)', locked: true },
                            { start: '(10', end: '15)', locked: true },
                            { start: '(15', end: '+âˆ)', locked: false }
                        ]
                    },
                    {
                        title: 'ğŸš« äº‹åŠ¡Bå°è¯•æ’å…¥',
                        description: 'äº‹åŠ¡Bå°è¯•åœ¨é”å®šçš„é—´éš™ä¸­æ’å…¥æ–°è®°å½•ï¼Œè¢«é˜»å¡ã€‚',
                        explanation: 'é—´éš™é”é˜»æ­¢äº†åœ¨(1,5)ã€(5,10)ã€(10,15)é—´éš™ä¸­æ’å…¥æ–°è®°å½•ã€‚',
                        indexData: [
                            { id: 1, name: 'å¼ ä¸‰', age: 25, locked: false, lockType: null },
                            { id: 5, name: 'æå››', age: 30, locked: false, lockType: null },
                            { id: 10, name: 'ç‹äº”', age: 35, locked: false, lockType: null },
                            { id: 15, name: 'èµµå…­', age: 40, locked: false, lockType: null }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'SELECT * FROM users WHERE id > 3 AND id < 12 FOR UPDATE', status: 'active' },
                            { id: 'T2', sql: 'BEGIN', status: 'active' },
                            { id: 'T2', sql: 'INSERT INTO users VALUES (7, "æ–°ç”¨æˆ·", 28)', status: 'blocked' }
                        ],
                        legend: [
                            { type: 'gap', name: 'é—´éš™é”', description: 'é”å®šç´¢å¼•è®°å½•ä¹‹é—´çš„é—´éš™' }
                        ],
                        gaps: [
                            { start: '(-âˆ', end: '1)', locked: false },
                            { start: '(1', end: '5)', locked: true },
                            { start: '(5', end: '10)', locked: true },
                            { start: '(10', end: '15)', locked: true },
                            { start: '(15', end: '+âˆ)', locked: false }
                        ]
                    },
                    {
                        title: 'âœ… å…è®¸çš„æ’å…¥æ“ä½œ',
                        description: 'äº‹åŠ¡Cå¯ä»¥åœ¨æœªé”å®šçš„é—´éš™ä¸­æ’å…¥è®°å½•ã€‚',
                        explanation: 'é—´éš™é”åªé”å®šç‰¹å®šèŒƒå›´ï¼Œå…¶ä»–é—´éš™ä»ç„¶å¯ä»¥æ’å…¥ã€‚',
                        indexData: [
                            { id: 1, name: 'å¼ ä¸‰', age: 25, locked: false, lockType: null },
                            { id: 5, name: 'æå››', age: 30, locked: false, lockType: null },
                            { id: 10, name: 'ç‹äº”', age: 35, locked: false, lockType: null },
                            { id: 15, name: 'èµµå…­', age: 40, locked: false, lockType: null },
                            { id: 20, name: 'æ–°ç”¨æˆ·', age: 45, locked: false, lockType: null }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'SELECT * FROM users WHERE id > 3 AND id < 12 FOR UPDATE', status: 'active' },
                            { id: 'T2', sql: 'INSERT INTO users VALUES (7, "æ–°ç”¨æˆ·", 28)', status: 'blocked' },
                            { id: 'T3', sql: 'INSERT INTO users VALUES (20, "æ–°ç”¨æˆ·", 45)', status: 'completed' }
                        ],
                        legend: [
                            { type: 'gap', name: 'é—´éš™é”', description: 'é”å®šç´¢å¼•è®°å½•ä¹‹é—´çš„é—´éš™' }
                        ],
                        gaps: [
                            { start: '(-âˆ', end: '1)', locked: false },
                            { start: '(1', end: '5)', locked: true },
                            { start: '(5', end: '10)', locked: true },
                            { start: '(10', end: '15)', locked: true },
                            { start: '(15', end: '+âˆ)', locked: false }
                        ]
                    },
                    {
                        title: 'ğŸ”“ äº‹åŠ¡Aæäº¤é‡Šæ”¾é”',
                        description: 'äº‹åŠ¡Aæäº¤ï¼Œé‡Šæ”¾é—´éš™é”ï¼Œäº‹åŠ¡Bå¯ä»¥ç»§ç»­æ‰§è¡Œã€‚',
                        explanation: 'é—´éš™é”çš„é‡Šæ”¾å…è®¸è¢«é˜»å¡çš„æ’å…¥æ“ä½œç»§ç»­æ‰§è¡Œã€‚',
                        indexData: [
                            { id: 1, name: 'å¼ ä¸‰', age: 25, locked: false, lockType: null },
                            { id: 5, name: 'æå››', age: 30, locked: false, lockType: null },
                            { id: 7, name: 'æ–°ç”¨æˆ·', age: 28, locked: false, lockType: null },
                            { id: 10, name: 'ç‹äº”', age: 35, locked: false, lockType: null },
                            { id: 15, name: 'èµµå…­', age: 40, locked: false, lockType: null },
                            { id: 20, name: 'æ–°ç”¨æˆ·', age: 45, locked: false, lockType: null }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'COMMIT', status: 'completed' },
                            { id: 'T2', sql: 'INSERT INTO users VALUES (7, "æ–°ç”¨æˆ·", 28)', status: 'completed' },
                            { id: 'T2', sql: 'COMMIT', status: 'completed' }
                        ],
                        legend: [
                            { type: 'gap', name: 'é—´éš™é”', description: 'é”å®šç´¢å¼•è®°å½•ä¹‹é—´çš„é—´éš™' }
                        ],
                        gaps: [
                            { start: '(-âˆ', end: '1)', locked: false },
                            { start: '(1', end: '5)', locked: false },
                            { start: '(5', end: '7)', locked: false },
                            { start: '(7', end: '10)', locked: false },
                            { start: '(10', end: '15)', locked: false },
                            { start: '(15', end: '20)', locked: false },
                            { start: '(20', end: '+âˆ)', locked: false }
                        ]
                    }
                ]
            },
            nextkey: {
                title: 'ä¸´é”®é”æ¼”ç¤º',
                subtitle: 'äº†è§£ä¸´é”®é”å¦‚ä½•ç»“åˆè®°å½•é”å’Œé—´éš™é”é˜²æ­¢å¹»è¯»',
                steps: [
                    {
                        title: 'ğŸ“‹ å‡†å¤‡æµ‹è¯•æ•°æ®',
                        description: 'åˆ›å»ºç”¨æˆ·è¡¨å¹¶æ’å…¥æµ‹è¯•æ•°æ®ï¼Œå»ºç«‹æ™®é€šç´¢å¼•ã€‚',
                        explanation: 'ä¸´é”®é”æ˜¯è®°å½•é”å’Œé—´éš™é”çš„ç»„åˆï¼Œé”å®šè®°å½•æœ¬èº«åŠå…¶å‰é¢çš„é—´éš™ã€‚',
                        indexData: [
                            { id: 1, name: 'å¼ ä¸‰', age: 25, locked: false, lockType: null },
                            { id: 5, name: 'æå››', age: 30, locked: false, lockType: null },
                            { id: 10, name: 'ç‹äº”', age: 35, locked: false, lockType: null },
                            { id: 15, name: 'èµµå…­', age: 40, locked: false, lockType: null }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'CREATE TABLE users (id INT PRIMARY KEY, name VARCHAR(50), age INT, INDEX idx_age(age))', status: 'completed' },
                            { id: 'T2', sql: 'INSERT INTO users VALUES (1,"å¼ ä¸‰",25), (5,"æå››",30), (10,"ç‹äº”",35), (15,"èµµå…­",40)', status: 'completed' }
                        ],
                        legend: [
                            { type: 'nextkey', name: 'ä¸´é”®é”', description: 'è®°å½•é”+é—´éš™é”çš„ç»„åˆ' }
                        ],
                        gaps: [
                            { start: '(-âˆ', end: '25]', locked: false },
                            { start: '(25', end: '30]', locked: false },
                            { start: '(30', end: '35]', locked: false },
                            { start: '(35', end: '40]', locked: false },
                            { start: '(40', end: '+âˆ)', locked: false }
                        ]
                    },
                    {
                        title: 'ğŸ”’ äº‹åŠ¡Aæ‰§è¡ŒèŒƒå›´æŸ¥è¯¢',
                        description: 'äº‹åŠ¡Aæ‰§è¡ŒSELECT ... FOR UPDATEï¼Œå¯¹age >= 30çš„è®°å½•åŠ ä¸´é”®é”ã€‚',
                        explanation: 'ä¸´é”®é”é”å®šäº†age=30,35,40çš„è®°å½•ä»¥åŠ(25,30]ã€(30,35]ã€(35,40]ã€(40,+âˆ)çš„é—´éš™ã€‚',
                        indexData: [
                            { id: 1, name: 'å¼ ä¸‰', age: 25, locked: false, lockType: null },
                            { id: 5, name: 'æå››', age: 30, locked: true, lockType: 'nextkey' },
                            { id: 10, name: 'ç‹äº”', age: 35, locked: true, lockType: 'nextkey' },
                            { id: 15, name: 'èµµå…­', age: 40, locked: true, lockType: 'nextkey' }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'BEGIN', status: 'active' },
                            { id: 'T1', sql: 'SELECT * FROM users WHERE age >= 30 FOR UPDATE', status: 'active' }
                        ],
                        legend: [
                            { type: 'nextkey', name: 'ä¸´é”®é”', description: 'è®°å½•é”+é—´éš™é”çš„ç»„åˆ' }
                        ],
                        gaps: [
                            { start: '(-âˆ', end: '25]', locked: false },
                            { start: '(25', end: '30]', locked: true },
                            { start: '(30', end: '35]', locked: true },
                            { start: '(35', end: '40]', locked: true },
                            { start: '(40', end: '+âˆ)', locked: true }
                        ]
                    },
                    {
                        title: 'ğŸš« äº‹åŠ¡Bå°è¯•æ’å…¥',
                        description: 'äº‹åŠ¡Bå°è¯•æ’å…¥age=32çš„è®°å½•ï¼Œè¢«ä¸´é”®é”é˜»å¡ã€‚',
                        explanation: 'ä¸´é”®é”é˜»æ­¢äº†åœ¨é”å®šé—´éš™å†…æ’å…¥æ–°è®°å½•ï¼Œé˜²æ­¢å¹»è¯»ã€‚',
                        indexData: [
                            { id: 1, name: 'å¼ ä¸‰', age: 25, locked: false, lockType: null },
                            { id: 5, name: 'æå››', age: 30, locked: true, lockType: 'nextkey' },
                            { id: 10, name: 'ç‹äº”', age: 35, locked: true, lockType: 'nextkey' },
                            { id: 15, name: 'èµµå…­', age: 40, locked: true, lockType: 'nextkey' }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'SELECT * FROM users WHERE age >= 30 FOR UPDATE', status: 'active' },
                            { id: 'T2', sql: 'BEGIN', status: 'active' },
                            { id: 'T2', sql: 'INSERT INTO users VALUES (8, "æ–°ç”¨æˆ·", 32)', status: 'blocked' }
                        ],
                        legend: [
                            { type: 'nextkey', name: 'ä¸´é”®é”', description: 'è®°å½•é”+é—´éš™é”çš„ç»„åˆ' }
                        ],
                        gaps: [
                            { start: '(-âˆ', end: '25]', locked: false },
                            { start: '(25', end: '30]', locked: true },
                            { start: '(30', end: '35]', locked: true },
                            { start: '(35', end: '40]', locked: true },
                            { start: '(40', end: '+âˆ)', locked: true }
                        ]
                    },
                    {
                        title: 'âœ… å…è®¸çš„æ“ä½œ',
                        description: 'äº‹åŠ¡Cå¯ä»¥æ’å…¥age=28çš„è®°å½•ï¼Œå› ä¸ºä¸åœ¨é”å®šèŒƒå›´å†…ã€‚',
                        explanation: 'ä¸´é”®é”åªé”å®šç‰¹å®šèŒƒå›´ï¼Œæœªé”å®šçš„é—´éš™ä»ç„¶å¯ä»¥æ’å…¥ã€‚',
                        indexData: [
                            { id: 1, name: 'å¼ ä¸‰', age: 25, locked: false, lockType: null },
                            { id: 3, name: 'æ–°ç”¨æˆ·', age: 28, locked: false, lockType: null },
                            { id: 5, name: 'æå››', age: 30, locked: true, lockType: 'nextkey' },
                            { id: 10, name: 'ç‹äº”', age: 35, locked: true, lockType: 'nextkey' },
                            { id: 15, name: 'èµµå…­', age: 40, locked: true, lockType: 'nextkey' }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'SELECT * FROM users WHERE age >= 30 FOR UPDATE', status: 'active' },
                            { id: 'T2', sql: 'INSERT INTO users VALUES (8, "æ–°ç”¨æˆ·", 32)', status: 'blocked' },
                            { id: 'T3', sql: 'INSERT INTO users VALUES (3, "æ–°ç”¨æˆ·", 28)', status: 'completed' }
                        ],
                        legend: [
                            { type: 'nextkey', name: 'ä¸´é”®é”', description: 'è®°å½•é”+é—´éš™é”çš„ç»„åˆ' }
                        ],
                        gaps: [
                            { start: '(-âˆ', end: '25]', locked: false },
                            { start: '(25', end: '30]', locked: true },
                            { start: '(30', end: '35]', locked: true },
                            { start: '(35', end: '40]', locked: true },
                            { start: '(40', end: '+âˆ)', locked: true }
                        ]
                    },
                    {
                        title: 'ğŸ”“ äº‹åŠ¡Aæäº¤é‡Šæ”¾é”',
                        description: 'äº‹åŠ¡Aæäº¤ï¼Œé‡Šæ”¾ä¸´é”®é”ï¼Œäº‹åŠ¡Bå¯ä»¥ç»§ç»­æ‰§è¡Œã€‚',
                        explanation: 'ä¸´é”®é”çš„é‡Šæ”¾å…è®¸è¢«é˜»å¡çš„æ’å…¥å’Œæ›´æ–°æ“ä½œç»§ç»­æ‰§è¡Œã€‚',
                        indexData: [
                            { id: 1, name: 'å¼ ä¸‰', age: 25, locked: false, lockType: null },
                            { id: 3, name: 'æ–°ç”¨æˆ·', age: 28, locked: false, lockType: null },
                            { id: 5, name: 'æå››', age: 30, locked: false, lockType: null },
                            { id: 8, name: 'æ–°ç”¨æˆ·', age: 32, locked: false, lockType: null },
                            { id: 10, name: 'ç‹äº”', age: 35, locked: false, lockType: null },
                            { id: 15, name: 'èµµå…­', age: 40, locked: false, lockType: null }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'COMMIT', status: 'completed' },
                            { id: 'T2', sql: 'INSERT INTO users VALUES (8, "æ–°ç”¨æˆ·", 32)', status: 'completed' },
                            { id: 'T2', sql: 'COMMIT', status: 'completed' }
                        ],
                        legend: [
                            { type: 'nextkey', name: 'ä¸´é”®é”', description: 'è®°å½•é”+é—´éš™é”çš„ç»„åˆ' }
                        ],
                        gaps: [
                            { start: '(-âˆ', end: '25]', locked: false },
                            { start: '(25', end: '28]', locked: false },
                            { start: '(28', end: '30]', locked: false },
                            { start: '(30', end: '32]', locked: false },
                            { start: '(32', end: '35]', locked: false },
                            { start: '(35', end: '40]', locked: false },
                            { start: '(40', end: '+âˆ)', locked: false }
                        ]
                    }
                ]
            },
            deadlock: {
                title: 'æ­»é”æ£€æµ‹æ¼”ç¤º',
                subtitle: 'äº†è§£InnoDBå¦‚ä½•æ£€æµ‹å’Œè§£å†³æ­»é”é—®é¢˜',
                steps: [
                    {
                        title: 'ğŸ“‹ å‡†å¤‡æµ‹è¯•æ•°æ®',
                        description: 'åˆ›å»ºç”¨æˆ·è¡¨å¹¶æ’å…¥æµ‹è¯•æ•°æ®ï¼Œå‡†å¤‡æ­»é”æ¼”ç¤ºåœºæ™¯ã€‚',
                        explanation: 'æ­»é”å‘ç”Ÿåœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡ç›¸äº’ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”çš„æƒ…å†µã€‚',
                        indexData: [
                            { id: 1, name: 'å¼ ä¸‰', age: 25, locked: false, lockType: null },
                            { id: 5, name: 'æå››', age: 30, locked: false, lockType: null }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'CREATE TABLE users (id INT PRIMARY KEY, name VARCHAR(50), age INT)', status: 'completed' },
                            { id: 'T2', sql: 'INSERT INTO users VALUES (1,"å¼ ä¸‰",25), (5,"æå››",30)', status: 'completed' }
                        ],
                        legend: [
                            { type: 'deadlock', name: 'æ­»é”æ£€æµ‹', description: 'InnoDBè‡ªåŠ¨æ£€æµ‹å¹¶è§£å†³æ­»é”' }
                        ],
                        waitGraph: []
                    },
                    {
                        title: 'ğŸ”’ äº‹åŠ¡Aé”å®šè®°å½•1',
                        description: 'äº‹åŠ¡Aå¼€å§‹ï¼Œé”å®šid=1çš„è®°å½•ã€‚',
                        explanation: 'äº‹åŠ¡Aè·å¾—id=1è®°å½•çš„æ’ä»–é”ã€‚',
                        indexData: [
                            { id: 1, name: 'å¼ ä¸‰', age: 25, locked: true, lockType: 'exclusive' },
                            { id: 5, name: 'æå››', age: 30, locked: false, lockType: null }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'BEGIN', status: 'active' },
                            { id: 'T1', sql: 'UPDATE users SET age = 26 WHERE id = 1', status: 'active' }
                        ],
                        legend: [
                            { type: 'exclusive', name: 'æ’ä»–é”(X)', description: 'é˜»æ­¢å…¶ä»–äº‹åŠ¡è¯»å†™' }
                        ],
                        waitGraph: [
                            { from: 'T1', to: null, resource: 'id=1', status: 'holding' }
                        ]
                    },
                    {
                        title: 'ğŸ”’ äº‹åŠ¡Bé”å®šè®°å½•5',
                        description: 'äº‹åŠ¡Bå¼€å§‹ï¼Œé”å®šid=5çš„è®°å½•ã€‚',
                        explanation: 'äº‹åŠ¡Bè·å¾—id=5è®°å½•çš„æ’ä»–é”ã€‚',
                        indexData: [
                            { id: 1, name: 'å¼ ä¸‰', age: 25, locked: true, lockType: 'exclusive' },
                            { id: 5, name: 'æå››', age: 30, locked: true, lockType: 'exclusive' }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'UPDATE users SET age = 26 WHERE id = 1', status: 'active' },
                            { id: 'T2', sql: 'BEGIN', status: 'active' },
                            { id: 'T2', sql: 'UPDATE users SET age = 31 WHERE id = 5', status: 'active' }
                        ],
                        legend: [
                            { type: 'exclusive', name: 'æ’ä»–é”(X)', description: 'é˜»æ­¢å…¶ä»–äº‹åŠ¡è¯»å†™' }
                        ],
                        waitGraph: [
                            { from: 'T1', to: null, resource: 'id=1', status: 'holding' },
                            { from: 'T2', to: null, resource: 'id=5', status: 'holding' }
                        ]
                    },
                    {
                        title: 'â³ äº‹åŠ¡Aç­‰å¾…è®°å½•5',
                        description: 'äº‹åŠ¡Aå°è¯•é”å®šid=5çš„è®°å½•ï¼Œè¢«äº‹åŠ¡Bé˜»å¡ã€‚',
                        explanation: 'äº‹åŠ¡Aç­‰å¾…äº‹åŠ¡Bé‡Šæ”¾id=5çš„é”ã€‚',
                        indexData: [
                            { id: 1, name: 'å¼ ä¸‰', age: 25, locked: true, lockType: 'exclusive' },
                            { id: 5, name: 'æå››', age: 30, locked: true, lockType: 'exclusive' }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'UPDATE users SET age = 26 WHERE id = 1', status: 'active' },
                            { id: 'T1', sql: 'UPDATE users SET age = 32 WHERE id = 5', status: 'blocked' },
                            { id: 'T2', sql: 'UPDATE users SET age = 31 WHERE id = 5', status: 'active' }
                        ],
                        legend: [
                            { type: 'exclusive', name: 'æ’ä»–é”(X)', description: 'é˜»æ­¢å…¶ä»–äº‹åŠ¡è¯»å†™' },
                            { type: 'waiting', name: 'ç­‰å¾…é”', description: 'äº‹åŠ¡ç­‰å¾…è·å–é”' }
                        ],
                        waitGraph: [
                            { from: 'T1', to: null, resource: 'id=1', status: 'holding' },
                            { from: 'T1', to: 'T2', resource: 'id=5', status: 'waiting' },
                            { from: 'T2', to: null, resource: 'id=5', status: 'holding' }
                        ]
                    },
                    {
                        title: 'ğŸ’€ å½¢æˆæ­»é”',
                        description: 'äº‹åŠ¡Bå°è¯•é”å®šid=1çš„è®°å½•ï¼Œå½¢æˆæ­»é”ç¯è·¯ã€‚',
                        explanation: 'äº‹åŠ¡Aç­‰å¾…äº‹åŠ¡Bï¼Œäº‹åŠ¡Bç­‰å¾…äº‹åŠ¡Aï¼Œå½¢æˆæ­»é”ã€‚',
                        indexData: [
                            { id: 1, name: 'å¼ ä¸‰', age: 25, locked: true, lockType: 'exclusive' },
                            { id: 5, name: 'æå››', age: 30, locked: true, lockType: 'exclusive' }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'UPDATE users SET age = 32 WHERE id = 5', status: 'blocked' },
                            { id: 'T2', sql: 'UPDATE users SET age = 31 WHERE id = 5', status: 'active' },
                            { id: 'T2', sql: 'UPDATE users SET age = 27 WHERE id = 1', status: 'blocked' }
                        ],
                        legend: [
                            { type: 'deadlock', name: 'æ­»é”', description: 'äº‹åŠ¡ç›¸äº’ç­‰å¾…å½¢æˆç¯è·¯' },
                            { type: 'exclusive', name: 'æ’ä»–é”(X)', description: 'é˜»æ­¢å…¶ä»–äº‹åŠ¡è¯»å†™' }
                        ],
                        waitGraph: [
                            { from: 'T1', to: null, resource: 'id=1', status: 'holding' },
                            { from: 'T1', to: 'T2', resource: 'id=5', status: 'waiting' },
                            { from: 'T2', to: null, resource: 'id=5', status: 'holding' },
                            { from: 'T2', to: 'T1', resource: 'id=1', status: 'waiting' }
                        ]
                    },
                    {
                        title: 'ğŸ”§ æ­»é”æ£€æµ‹å’Œè§£å†³',
                        description: 'InnoDBæ£€æµ‹åˆ°æ­»é”ï¼Œå›æ»šäº‹åŠ¡Bï¼Œäº‹åŠ¡Aç»§ç»­æ‰§è¡Œã€‚',
                        explanation: 'InnoDBé€‰æ‹©å›æ»šä»£ä»·è¾ƒå°çš„äº‹åŠ¡æ¥è§£å†³æ­»é”ã€‚',
                        indexData: [
                            { id: 1, name: 'å¼ ä¸‰', age: 26, locked: true, lockType: 'exclusive' },
                            { id: 5, name: 'æå››', age: 32, locked: true, lockType: 'exclusive' }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'UPDATE users SET age = 32 WHERE id = 5', status: 'active' },
                            { id: 'T1', sql: 'COMMIT', status: 'completed' },
                            { id: 'T2', sql: 'ROLLBACK (Deadlock detected)', status: 'rollback' }
                        ],
                        legend: [
                            { type: 'deadlock-resolved', name: 'æ­»é”å·²è§£å†³', description: 'InnoDBè‡ªåŠ¨å›æ»šä¸€ä¸ªäº‹åŠ¡' },
                            { type: 'exclusive', name: 'æ’ä»–é”(X)', description: 'é˜»æ­¢å…¶ä»–äº‹åŠ¡è¯»å†™' }
                        ],
                        waitGraph: [
                            { from: 'T1', to: null, resource: 'id=1,5', status: 'holding' }
                        ]
                    }
                ]
            },
            lockingprocess: {
                title: 'è¯¦ç»†åŠ é”æµç¨‹æ¼”ç¤º',
                subtitle: 'æ·±å…¥äº†è§£InnoDBå¦‚ä½•å¯¹å…·ä½“æ•°æ®è¿›è¡ŒåŠ é”',
                steps: [
                    {
                        title: 'ğŸ“‹ SQLè§£æä¸æ‰§è¡Œè®¡åˆ’',
                        description: 'UPDATE users SET name = "å¼ ä¸‰" WHERE id = 10 - è§£æSQLå¹¶ç”Ÿæˆæ‰§è¡Œè®¡åˆ’',
                        explanation: 'æ‰§è¡Œå¼•æ“é¦–å…ˆè§£æSQLè¯­å¥ï¼Œç¡®å®šä½¿ç”¨ä¸»é”®ç´¢å¼•ï¼Œç”Ÿæˆæœ€ä¼˜æ‰§è¡Œè®¡åˆ’ã€‚',
                        indexData: [
                            { id: 1, name: 'ç”¨æˆ·A', age: 25, locked: false, lockType: null },
                            { id: 5, name: 'ç”¨æˆ·B', age: 30, locked: false, lockType: null },
                            { id: 10, name: 'ç”¨æˆ·C', age: 35, locked: false, lockType: null, highlight: true },
                            { id: 15, name: 'ç”¨æˆ·D', age: 40, locked: false, lockType: null }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'BEGIN', status: 'active' },
                            { id: 'T1', sql: 'è§£æ: UPDATE users SET name = "å¼ ä¸‰" WHERE id = 10', status: 'active' },
                            { id: 'T1', sql: 'æ‰§è¡Œè®¡åˆ’: ä½¿ç”¨ä¸»é”®ç´¢å¼•å®šä½è®°å½•', status: 'active' }
                        ],
                        legend: [
                            { type: 'highlight', name: 'ç›®æ ‡è®°å½•', description: 'å³å°†è¢«é”å®šçš„è®°å½•' }
                        ],
                        lockingSteps: [
                            { step: 1, description: 'SQLè§£æå™¨åˆ†æè¯­å¥ç»“æ„', status: 'completed' },
                            { step: 2, description: 'ä¼˜åŒ–å™¨é€‰æ‹©ä¸»é”®ç´¢å¼•', status: 'completed' },
                            { step: 3, description: 'ç”Ÿæˆæ‰§è¡Œè®¡åˆ’', status: 'completed' },
                            { step: 4, description: 'å‡†å¤‡å¼€å§‹æ‰§è¡Œ', status: 'active' }
                        ]
                    },
                    {
                        title: 'ğŸ” ç´¢å¼•æ‰«æå®šä½è®°å½•',
                        description: 'é€šè¿‡ä¸»é”®ç´¢å¼•å®šä½åˆ°id=10çš„è®°å½•ä½ç½®',
                        explanation: 'æ‰§è¡Œå¼•æ“ä½¿ç”¨B+æ ‘ç´¢å¼•å¿«é€Ÿå®šä½åˆ°ç›®æ ‡è®°å½•çš„ç‰©ç†ä½ç½®ã€‚',
                        indexData: [
                            { id: 1, name: 'ç”¨æˆ·A', age: 25, locked: false, lockType: null },
                            { id: 5, name: 'ç”¨æˆ·B', age: 30, locked: false, lockType: null },
                            { id: 10, name: 'ç”¨æˆ·C', age: 35, locked: false, lockType: null, highlight: true, scanning: true },
                            { id: 15, name: 'ç”¨æˆ·D', age: 40, locked: false, lockType: null }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'ç´¢å¼•æ‰«æ: å®šä½id=10è®°å½•', status: 'active' },
                            { id: 'T1', sql: 'è®°å½•ä½ç½®: space_id=1, page_no=3, heap_no=2', status: 'active' }
                        ],
                        legend: [
                            { type: 'scanning', name: 'æ­£åœ¨æ‰«æ', description: 'ç´¢å¼•æ‰«æå®šä½ä¸­' }
                        ],
                        lockingSteps: [
                            { step: 1, description: 'éå†B+æ ‘æ ¹èŠ‚ç‚¹', status: 'completed' },
                            { step: 2, description: 'å®šä½åˆ°å¶å­èŠ‚ç‚¹é¡µé¢', status: 'completed' },
                            { step: 3, description: 'åœ¨é¡µé¢ä¸­æ‰¾åˆ°ç›®æ ‡è®°å½•', status: 'active' },
                            { step: 4, description: 'è·å–è®°å½•çš„ç‰©ç†ä½ç½®ä¿¡æ¯', status: 'waiting' }
                        ]
                    },
                    {
                        title: 'ğŸ”’ æ£€æŸ¥é”å†²çª',
                        description: 'æ£€æŸ¥ç›®æ ‡è®°å½•æ˜¯å¦å·²è¢«å…¶ä»–äº‹åŠ¡é”å®š',
                        explanation: 'InnoDBæ£€æŸ¥é”è¡¨ï¼Œç¡®è®¤è¯¥è®°å½•å½“å‰æ²¡æœ‰è¢«å…¶ä»–äº‹åŠ¡æŒæœ‰å†²çªçš„é”ã€‚',
                        indexData: [
                            { id: 1, name: 'ç”¨æˆ·A', age: 25, locked: false, lockType: null },
                            { id: 5, name: 'ç”¨æˆ·B', age: 30, locked: false, lockType: null },
                            { id: 10, name: 'ç”¨æˆ·C', age: 35, locked: false, lockType: null, highlight: true, checking: true },
                            { id: 15, name: 'ç”¨æˆ·D', age: 40, locked: false, lockType: null }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'é”å†²çªæ£€æµ‹: æ£€æŸ¥è®°å½•id=10çš„é”çŠ¶æ€', status: 'active' },
                            { id: 'T1', sql: 'æ£€æµ‹ç»“æœ: æ— å†²çªé”ï¼Œå¯ä»¥åŠ é”', status: 'active' }
                        ],
                        legend: [
                            { type: 'checking', name: 'å†²çªæ£€æµ‹', description: 'æ£€æŸ¥æ˜¯å¦å­˜åœ¨é”å†²çª' }
                        ],
                        lockingSteps: [
                            { step: 1, description: 'æŸ¥è¯¢é”è¡¨ä¸­çš„è®°å½•', status: 'completed' },
                            { step: 2, description: 'æ£€æŸ¥é”å…¼å®¹æ€§', status: 'active' },
                            { step: 3, description: 'ç¡®è®¤æ— å†²çª', status: 'waiting' },
                            { step: 4, description: 'å‡†å¤‡åŠ é”', status: 'waiting' }
                        ],
                        lockTable: [
                            { space_id: 1, page_no: 3, heap_no: 2, lock_type: 'NONE', trx_id: null, waiting: false }
                        ]
                    },
                    {
                        title: 'ğŸ” åŠ æ’ä»–é”',
                        description: 'åœ¨id=10çš„è®°å½•ä¸ŠæˆåŠŸåŠ æ’ä»–é”',
                        explanation: 'åœ¨é”è¡¨ä¸­åˆ›å»ºé”è®°å½•ï¼Œæ ‡è®°è¯¥è®°å½•è¢«å½“å‰äº‹åŠ¡ä»¥æ’ä»–æ¨¡å¼é”å®šã€‚',
                        indexData: [
                            { id: 1, name: 'ç”¨æˆ·A', age: 25, locked: false, lockType: null },
                            { id: 5, name: 'ç”¨æˆ·B', age: 30, locked: false, lockType: null },
                            { id: 10, name: 'ç”¨æˆ·C', age: 35, locked: true, lockType: 'exclusive', trx_id: 'T1' },
                            { id: 15, name: 'ç”¨æˆ·D', age: 40, locked: false, lockType: null }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'åŠ é”æˆåŠŸ: è®°å½•id=10å·²è¢«æ’ä»–é”é”å®š', status: 'active' },
                            { id: 'T1', sql: 'é”ä¿¡æ¯: space_id=1, page_no=3, heap_no=2, lock_type=X', status: 'active' }
                        ],
                        legend: [
                            { type: 'exclusive', name: 'æ’ä»–é”(X)', description: 'é˜»æ­¢å…¶ä»–äº‹åŠ¡è¯»å†™' }
                        ],
                        lockingSteps: [
                            { step: 1, description: 'åˆ›å»ºé”ç»“æ„', status: 'completed' },
                            { step: 2, description: 'è®¾ç½®é”ç±»å‹ä¸ºæ’ä»–é”', status: 'completed' },
                            { step: 3, description: 'è®°å½•äº‹åŠ¡ID', status: 'completed' },
                            { step: 4, description: 'æ’å…¥é”è¡¨', status: 'active' }
                        ],
                        lockTable: [
                            { space_id: 1, page_no: 3, heap_no: 2, lock_type: 'X', trx_id: 'T1', waiting: false }
                        ]
                    },
                    {
                        title: 'âœï¸ æ‰§è¡Œæ•°æ®ä¿®æ”¹',
                        description: 'åœ¨è·å¾—é”åï¼Œæ‰§è¡Œå®é™…çš„æ•°æ®ä¿®æ”¹æ“ä½œ',
                        explanation: 'é”å®šè®°å½•åï¼Œäº‹åŠ¡å¯ä»¥å®‰å…¨åœ°ä¿®æ”¹æ•°æ®ï¼ŒåŒæ—¶ç”Ÿæˆundo logç”¨äºå›æ»šã€‚',
                        indexData: [
                            { id: 1, name: 'ç”¨æˆ·A', age: 25, locked: false, lockType: null },
                            { id: 5, name: 'ç”¨æˆ·B', age: 30, locked: false, lockType: null },
                            { id: 10, name: 'å¼ ä¸‰', age: 35, locked: true, lockType: 'exclusive', trx_id: 'T1', modified: true },
                            { id: 15, name: 'ç”¨æˆ·D', age: 40, locked: false, lockType: null }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'æ•°æ®ä¿®æ”¹: name "ç”¨æˆ·C" -> "å¼ ä¸‰"', status: 'active' },
                            { id: 'T1', sql: 'Undo Log: è®°å½•åŸå§‹å€¼ "ç”¨æˆ·C"', status: 'active' },
                            { id: 'T1', sql: 'Redo Log: è®°å½•ä¿®æ”¹æ“ä½œ', status: 'active' }
                        ],
                        legend: [
                            { type: 'modified', name: 'å·²ä¿®æ”¹', description: 'æ•°æ®å·²è¢«ä¿®æ”¹' },
                            { type: 'exclusive', name: 'æ’ä»–é”(X)', description: 'é˜»æ­¢å…¶ä»–äº‹åŠ¡è¯»å†™' }
                        ],
                        lockingSteps: [
                            { step: 1, description: 'ç”Ÿæˆundo logè®°å½•', status: 'completed' },
                            { step: 2, description: 'ä¿®æ”¹æ•°æ®é¡µä¸­çš„è®°å½•', status: 'completed' },
                            { step: 3, description: 'ç”Ÿæˆredo log', status: 'completed' },
                            { step: 4, description: 'æ›´æ–°äº‹åŠ¡ç‰ˆæœ¬ä¿¡æ¯', status: 'active' }
                        ],
                        lockTable: [
                            { space_id: 1, page_no: 3, heap_no: 2, lock_type: 'X', trx_id: 'T1', waiting: false }
                        ]
                    },
                    {
                        title: 'â³ å…¶ä»–äº‹åŠ¡ç­‰å¾…',
                        description: 'äº‹åŠ¡T2å°è¯•ä¿®æ”¹åŒä¸€è®°å½•ï¼Œè¢«é˜»å¡ç­‰å¾…',
                        explanation: 'ç”±äºè®°å½•å·²è¢«T1é”å®šï¼ŒT2å¿…é¡»ç­‰å¾…T1é‡Šæ”¾é”æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚',
                        indexData: [
                            { id: 1, name: 'ç”¨æˆ·A', age: 25, locked: false, lockType: null },
                            { id: 5, name: 'ç”¨æˆ·B', age: 30, locked: false, lockType: null },
                            { id: 10, name: 'å¼ ä¸‰', age: 35, locked: true, lockType: 'exclusive', trx_id: 'T1' },
                            { id: 15, name: 'ç”¨æˆ·D', age: 40, locked: false, lockType: null }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'UPDATE users SET name = "å¼ ä¸‰" WHERE id = 10', status: 'active' },
                            { id: 'T2', sql: 'BEGIN', status: 'active' },
                            { id: 'T2', sql: 'UPDATE users SET age = 36 WHERE id = 10', status: 'blocked' }
                        ],
                        legend: [
                            { type: 'exclusive', name: 'æ’ä»–é”(X)', description: 'T1æŒæœ‰çš„æ’ä»–é”' },
                            { type: 'waiting', name: 'ç­‰å¾…é”', description: 'T2ç­‰å¾…è·å–é”' }
                        ],
                        lockingSteps: [
                            { step: 1, description: 'T2å°è¯•è·å–æ’ä»–é”', status: 'completed' },
                            { step: 2, description: 'æ£€æµ‹åˆ°é”å†²çª', status: 'completed' },
                            { step: 3, description: 'åŠ å…¥ç­‰å¾…é˜Ÿåˆ—', status: 'active' },
                            { step: 4, description: 'è®¾ç½®é”ç­‰å¾…è¶…æ—¶', status: 'waiting' }
                        ],
                        lockTable: [
                            { space_id: 1, page_no: 3, heap_no: 2, lock_type: 'X', trx_id: 'T1', waiting: false },
                            { space_id: 1, page_no: 3, heap_no: 2, lock_type: 'X', trx_id: 'T2', waiting: true }
                        ],
                        waitGraph: [
                            { from: 'T1', to: null, resource: 'id=10', status: 'holding' },
                            { from: 'T2', to: 'T1', resource: 'id=10', status: 'waiting' }
                        ]
                    },
                    {
                        title: 'âœ… äº‹åŠ¡æäº¤é‡Šæ”¾é”',
                        description: 'äº‹åŠ¡T1æäº¤ï¼Œè‡ªåŠ¨é‡Šæ”¾æ‰€æœ‰æŒæœ‰çš„é”',
                        explanation: 'äº‹åŠ¡æäº¤æ—¶ï¼ŒInnoDBè‡ªåŠ¨é‡Šæ”¾è¯¥äº‹åŠ¡æŒæœ‰çš„æ‰€æœ‰é”ï¼Œç­‰å¾…çš„äº‹åŠ¡å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚',
                        indexData: [
                            { id: 1, name: 'ç”¨æˆ·A', age: 25, locked: false, lockType: null },
                            { id: 5, name: 'ç”¨æˆ·B', age: 30, locked: false, lockType: null },
                            { id: 10, name: 'å¼ ä¸‰', age: 36, locked: true, lockType: 'exclusive', trx_id: 'T2' },
                            { id: 15, name: 'ç”¨æˆ·D', age: 40, locked: false, lockType: null }
                        ],
                        transactions: [
                            { id: 'T1', sql: 'COMMIT', status: 'completed' },
                            { id: 'T2', sql: 'UPDATE users SET age = 36 WHERE id = 10', status: 'active' },
                            { id: 'T2', sql: 'è·å¾—é”ï¼Œå¼€å§‹æ‰§è¡Œä¿®æ”¹', status: 'active' }
                        ],
                        legend: [
                            { type: 'exclusive', name: 'æ’ä»–é”(X)', description: 'T2ç°åœ¨æŒæœ‰çš„æ’ä»–é”' }
                        ],
                        lockingSteps: [
                            { step: 1, description: 'T1æäº¤ï¼Œé‡Šæ”¾æ‰€æœ‰é”', status: 'completed' },
                            { step: 2, description: 'ä»é”è¡¨ä¸­ç§»é™¤T1çš„é”è®°å½•', status: 'completed' },
                            { step: 3, description: 'T2ä»ç­‰å¾…é˜Ÿåˆ—ä¸­å”¤é†’', status: 'completed' },
                            { step: 4, description: 'T2è·å¾—é”å¹¶æ‰§è¡Œ', status: 'active' }
                        ],
                        lockTable: [
                            { space_id: 1, page_no: 3, heap_no: 2, lock_type: 'X', trx_id: 'T2', waiting: false }
                        ]
                    }
                ]
            }
        };

        // åˆå§‹åŒ–æ¼”ç¤º
        function initDemo() {
            updateStepContent();
            updateProgress();
            updateButtons();
            updateStepIndicator();
            updateVisualization();
        }

        // é€‰æ‹©åœºæ™¯
        function selectScenario(scenario) {
            currentScenario = scenario;
            currentStep = 1;
            
            // æ›´æ–°åœºæ™¯æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.scenario-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // æ›´æ–°æ ‡é¢˜
            const config = scenarios[scenario];
            document.getElementById('workflow-title').textContent = config.title;
            document.getElementById('workflow-subtitle').textContent = config.subtitle;
            
            // æ›´æ–°æ˜¾ç¤º
            updateStepContent();
            updateProgress();
            updateButtons();
            updateStepIndicator();
            updateVisualization();
        }

        // ä¸‹ä¸€æ­¥
        function nextStep() {
            if (currentStep < scenarios[currentScenario].steps.length) {
                currentStep++;
                updateStepContent();
                updateProgress();
                updateButtons();
                updateStepIndicator();
                updateVisualization();
            }
        }

        // ä¸Šä¸€æ­¥
        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepContent();
                updateProgress();
                updateButtons();
                updateStepIndicator();
                updateVisualization();
            }
        }

        // é‡ç½®æ¼”ç¤º
        function resetDemo() {
            currentStep = 1;
            updateStepContent();
            updateProgress();
            updateButtons();
            updateStepIndicator();
            updateVisualization();
        }

        // æ›´æ–°æ­¥éª¤å†…å®¹
        function updateStepContent() {
            const step = scenarios[currentScenario].steps[currentStep - 1];
            const content = document.getElementById('step-content');
            
            content.innerHTML = `
                <div class="step-title">
                    ${step.title}
                </div>
                <div class="step-description">
                    ${step.description}
                </div>
                <div class="highlight-box">
                    <strong>è¯´æ˜ï¼š</strong>${step.explanation}
                </div>
            `;
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress() {
            const progress = (currentStep / scenarios[currentScenario].steps.length) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
        }

        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        function updateButtons() {
            const nextBtn = document.getElementById('next-button');
            const prevBtn = document.getElementById('prev-button');
            
            nextBtn.disabled = currentStep >= scenarios[currentScenario].steps.length;
            prevBtn.disabled = currentStep <= 1;
            
            if (nextBtn.disabled) {
                nextBtn.textContent = 'æ¼”ç¤ºå®Œæˆ';
            } else {
                nextBtn.textContent = 'ä¸‹ä¸€æ­¥';
            }
        }

        // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
        function updateStepIndicator() {
            const totalSteps = scenarios[currentScenario].steps.length;
            const indicator = document.getElementById('step-indicator');
            
            // æ¸…ç©ºç°æœ‰æ­¥éª¤
            indicator.innerHTML = '';
            
            // åˆ›å»ºæ­¥éª¤åœ†åœˆ
            for (let i = 1; i <= totalSteps; i++) {
                const step = document.createElement('div');
                step.className = 'step';
                step.textContent = i;
                step.id = `step-${i}`;
                
                if (i < currentStep) {
                    step.classList.add('completed');
                } else if (i === currentStep) {
                    step.classList.add('active');
                }
                
                indicator.appendChild(step);
            }
        }

        // æ›´æ–°å¯è§†åŒ–
        function updateVisualization() {
            const step = scenarios[currentScenario].steps[currentStep - 1];
            
            // æ›´æ–°ç´¢å¼•ç»“æ„
            updateIndexStructure(step.indexData);
            
            // æ›´æ–°é”å›¾ä¾‹
            updateLockLegend(step.legend);
            
            // æ›´æ–°äº‹åŠ¡çŠ¶æ€
            updateTransactionStatus(step.transactions);
            
            // æ›´æ–°é—´éš™å¯è§†åŒ–ï¼ˆå¦‚æœæœ‰ï¼‰
            if (step.gaps) {
                updateGapVisualization(step.gaps);
                document.getElementById('gap-visualization').style.display = 'block';
            } else {
                document.getElementById('gap-visualization').style.display = 'none';
            }
            
            // æ›´æ–°ç­‰å¾…å›¾ï¼ˆå¦‚æœæœ‰ï¼‰
            if (step.waitGraph) {
                updateWaitGraph(step.waitGraph);
                document.getElementById('wait-graph').style.display = 'block';
            } else {
                document.getElementById('wait-graph').style.display = 'none';
            }
            
            // æ›´æ–°è¡¨çº§é”ï¼ˆå¦‚æœæœ‰ï¼‰
            if (step.tableLocks) {
                updateTableLocks(step.tableLocks);
                document.getElementById('table-locks').style.display = 'block';
            } else {
                document.getElementById('table-locks').style.display = 'none';
            }
            
            // æ›´æ–°åŠ é”æ­¥éª¤ï¼ˆå¦‚æœæœ‰ï¼‰
            if (step.lockingSteps) {
                updateLockingSteps(step.lockingSteps);
                document.getElementById('locking-steps').style.display = 'block';
            } else {
                document.getElementById('locking-steps').style.display = 'none';
            }
            
            // æ›´æ–°é”è¡¨ï¼ˆå¦‚æœæœ‰ï¼‰
            if (step.lockTable) {
                updateLockTable(step.lockTable);
                document.getElementById('lock-table').style.display = 'block';
            } else {
                document.getElementById('lock-table').style.display = 'none';
            }
        }

        // æ›´æ–°ç´¢å¼•ç»“æ„
        function updateIndexStructure(indexData) {
            const container = document.getElementById('index-structure');
            container.innerHTML = '';
            
            indexData.forEach(row => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'index-row';
                
                if (row.locked) {
                    if (row.lockType === 'exclusive') {
                        rowDiv.classList.add('exclusive-locked');
                    } else if (row.lockType === 'shared') {
                        rowDiv.classList.add('shared-locked');
                    } else if (row.lockType === 'nextkey') {
                        rowDiv.classList.add('nextkey-locked');
                    } else if (row.lockType === 'deadlock') {
                        rowDiv.classList.add('deadlock-locked');
                    }
                }
                
                const lockText = {
                    'exclusive': 'Xé”',
                    'shared': 'Sé”',
                    'nextkey': 'NKé”',
                    'deadlock': 'æ­»é”',
                    'waiting': 'ç­‰å¾…'
                };
                
                rowDiv.innerHTML = `
                    <div>
                        <strong>ID: ${row.id}</strong><br>
                        <small>name: ${row.name}, age: ${row.age}</small>
                    </div>
                    ${row.locked ? `<div class="lock-indicator ${row.lockType}">${lockText[row.lockType] || row.lockType}</div>` : ''}
                `;
                
                container.appendChild(rowDiv);
            });
        }

        // æ›´æ–°é”å›¾ä¾‹
        function updateLockLegend(legend) {
            const container = document.getElementById('lock-legend');
            container.innerHTML = '';
            
            legend.forEach(item => {
                const legendDiv = document.createElement('div');
                legendDiv.className = 'legend-item';
                
                legendDiv.innerHTML = `
                    <div class="legend-color ${item.type}"></div>
                    <div>
                        <strong>${item.name}</strong><br>
                        <small>${item.description}</small>
                    </div>
                `;
                
                container.appendChild(legendDiv);
            });
        }

        // æ›´æ–°äº‹åŠ¡çŠ¶æ€
        function updateTransactionStatus(transactions) {
            const container = document.getElementById('transaction-status');
            container.innerHTML = '';
            
            transactions.forEach(tx => {
                const txDiv = document.createElement('div');
                txDiv.className = `transaction-item ${tx.status}`;
                
                txDiv.innerHTML = `
                    <strong>${tx.id}:</strong> ${tx.sql}
                    <div style="margin-top: 5px;">
                        <small>çŠ¶æ€: ${getStatusText(tx.status)}</small>
                    </div>
                `;
                
                container.appendChild(txDiv);
            });
        }

        // æ›´æ–°é—´éš™å¯è§†åŒ–
        function updateGapVisualization(gaps) {
            const container = document.getElementById('gap-visualization');
            container.innerHTML = '<h4>é—´éš™é”å¯è§†åŒ–ï¼š</h4>';
            
            const gapDiv = document.createElement('div');
            gapDiv.style.display = 'flex';
            gapDiv.style.alignItems = 'center';
            gapDiv.style.flexWrap = 'wrap';
            gapDiv.style.gap = '10px';
            
            gaps.forEach((gap, index) => {
                const gapItem = document.createElement('div');
                gapItem.className = 'gap-item gap';
                gapItem.textContent = `${gap.start}, ${gap.end}`;
                
                if (gap.locked) {
                    gapItem.style.background = '#ffc107';
                    gapItem.style.border = '2px solid #f39c12';
                    gapItem.style.fontWeight = 'bold';
                } else {
                    gapItem.style.background = '#e9ecef';
                    gapItem.style.border = '1px solid #dee2e6';
                }
                
                gapDiv.appendChild(gapItem);
                
                if (index < gaps.length - 1) {
                    const arrow = document.createElement('span');
                    arrow.className = 'gap-arrow';
                    arrow.textContent = 'â†’';
                    gapDiv.appendChild(arrow);
                }
            });
            
            container.appendChild(gapDiv);
        }

        // æ›´æ–°ç­‰å¾…å›¾
        function updateWaitGraph(waitGraph) {
            const container = document.getElementById('wait-graph');
            container.innerHTML = '<h4>äº‹åŠ¡ç­‰å¾…å›¾</h4>';
            
            const graphDiv = document.createElement('div');
            graphDiv.style.display = 'flex';
            graphDiv.style.alignItems = 'center';
            graphDiv.style.justifyContent = 'center';
            graphDiv.style.gap = '20px';
            graphDiv.style.padding = '20px';
            
            waitGraph.forEach((edge, index) => {
                const edgeDiv = document.createElement('div');
                edgeDiv.style.display = 'flex';
                edgeDiv.style.alignItems = 'center';
                edgeDiv.style.gap = '10px';
                
                edgeDiv.innerHTML = `
                    <div class="transaction-node" style="padding: 10px; background: #007bff; color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                        ${edge.from}
                    </div>
                    <div style="font-size: 20px; color: #dc3545;">â†’</div>
                    <div class="transaction-node" style="padding: 10px; background: #dc3545; color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                        ${edge.to}
                    </div>
                `;
                
                if (edge.cycle) {
                    edgeDiv.style.border = '2px solid #fd7e14';
                    edgeDiv.style.borderRadius = '10px';
                    edgeDiv.style.padding = '10px';
                    edgeDiv.style.background = '#fff3cd';
                }
                
                graphDiv.appendChild(edgeDiv);
                
                if (index < waitGraph.length - 1) {
                    const separator = document.createElement('div');
                    separator.textContent = '|';
                    separator.style.fontSize = '20px';
                    separator.style.color = '#6c757d';
                    graphDiv.appendChild(separator);
                }
            });
            
            container.appendChild(graphDiv);
        }
        
        // æ›´æ–°è¡¨çº§é”
        function updateTableLocks(tableLocks) {
            const container = document.getElementById('table-locks');
            container.innerHTML = '<h4>è¡¨çº§é”çŠ¶æ€</h4>';
            
            const tableDiv = document.createElement('div');
            tableDiv.style.display = 'grid';
            tableDiv.style.gridTemplateColumns = 'repeat(auto-fit, minmax(200px, 1fr))';
            tableDiv.style.gap = '15px';
            tableDiv.style.padding = '20px';
            
            tableLocks.forEach(lock => {
                const lockDiv = document.createElement('div');
                lockDiv.className = 'table-lock-item';
                lockDiv.style.padding = '15px';
                lockDiv.style.border = '2px solid #007bff';
                lockDiv.style.borderRadius = '8px';
                lockDiv.style.background = 'white';
                
                if (lock.type === 'intention-shared') {
                    lockDiv.style.borderColor = '#17a2b8';
                    lockDiv.style.background = '#d1ecf1';
                } else if (lock.type === 'intention-exclusive') {
                    lockDiv.style.borderColor = '#e83e8c';
                    lockDiv.style.background = '#f8d7da';
                } else if (lock.type === 'table-exclusive') {
                    lockDiv.style.borderColor = '#dc3545';
                    lockDiv.style.background = '#f8d7da';
                }
                
                lockDiv.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 8px;">${lock.table}</div>
                    <div class="lock-indicator ${lock.type}" style="display: inline-block; margin-bottom: 8px;">
                        ${lock.type === 'intention-shared' ? 'ISé”' : 
                          lock.type === 'intention-exclusive' ? 'IXé”' : 
                          lock.type === 'table-exclusive' ? 'è¡¨Xé”' : lock.type}
                    </div>
                    <div style="font-size: 0.9em; color: #6c757d;">
                        äº‹åŠ¡: ${lock.transaction}
                    </div>
                `;
                
                tableDiv.appendChild(lockDiv);
            });
            
            container.appendChild(tableDiv);
        }

        // æ›´æ–°åŠ é”æ­¥éª¤
        function updateLockingSteps(lockingSteps) {
            const container = document.getElementById('locking-steps');
            container.innerHTML = '<h4>åŠ é”æµç¨‹æ­¥éª¤</h4>';
            
            const stepsDiv = document.createElement('div');
            stepsDiv.style.display = 'grid';
            stepsDiv.style.gridTemplateColumns = 'repeat(auto-fit, minmax(250px, 1fr))';
            stepsDiv.style.gap = '15px';
            stepsDiv.style.padding = '20px';
            
            lockingSteps.forEach(step => {
                const stepDiv = document.createElement('div');
                stepDiv.className = 'locking-step-item';
                stepDiv.style.padding = '15px';
                stepDiv.style.border = '2px solid #e9ecef';
                stepDiv.style.borderRadius = '8px';
                stepDiv.style.background = 'white';
                
                if (step.status === 'completed') {
                    stepDiv.style.borderColor = '#28a745';
                    stepDiv.style.background = '#d4edda';
                } else if (step.status === 'active') {
                    stepDiv.style.borderColor = '#007bff';
                    stepDiv.style.background = '#d1ecf1';
                } else if (step.status === 'waiting') {
                    stepDiv.style.borderColor = '#ffc107';
                    stepDiv.style.background = '#fff3cd';
                }
                
                stepDiv.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 8px;">æ­¥éª¤ ${step.step}</div>
                    <div style="font-size: 0.9em; color: #495057;">${step.description}</div>
                    <div style="margin-top: 8px; font-size: 0.8em; color: #6c757d;">
                        çŠ¶æ€: ${getStatusText(step.status)}
                    </div>
                `;
                
                stepsDiv.appendChild(stepDiv);
            });
            
            container.appendChild(stepsDiv);
        }
        
        // æ›´æ–°é”è¡¨
        function updateLockTable(lockTable) {
            const container = document.getElementById('lock-table');
            container.innerHTML = '<h4>é”è¡¨çŠ¶æ€</h4>';
            
            const tableDiv = document.createElement('div');
            tableDiv.style.overflowX = 'auto';
            tableDiv.style.padding = '20px';
            
            const table = document.createElement('table');
            table.style.width = '100%';
            table.style.borderCollapse = 'collapse';
            table.style.background = 'white';
            table.style.borderRadius = '8px';
            table.style.overflow = 'hidden';
            table.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)';
            
            // è¡¨å¤´
            const thead = document.createElement('thead');
            thead.innerHTML = `
                <tr style="background: #f8f9fa; font-weight: bold;">
                    <th style="padding: 12px; border: 1px solid #dee2e6;">è¡¨ç©ºé—´ID</th>
                    <th style="padding: 12px; border: 1px solid #dee2e6;">é¡µå·</th>
                    <th style="padding: 12px; border: 1px solid #dee2e6;">è®°å½•å·</th>
                    <th style="padding: 12px; border: 1px solid #dee2e6;">é”ç±»å‹</th>
                    <th style="padding: 12px; border: 1px solid #dee2e6;">äº‹åŠ¡ID</th>
                    <th style="padding: 12px; border: 1px solid #dee2e6;">ç­‰å¾…çŠ¶æ€</th>
                </tr>
            `;
            table.appendChild(thead);
            
            // è¡¨ä½“
            const tbody = document.createElement('tbody');
            lockTable.forEach(lock => {
                const row = document.createElement('tr');
                
                if (lock.waiting) {
                    row.style.background = '#fff3cd';
                } else if (lock.lock_type === 'X') {
                    row.style.background = '#f8d7da';
                } else if (lock.lock_type === 'S') {
                    row.style.background = '#d1ecf1';
                }
                
                row.innerHTML = `
                    <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center;">${lock.space_id}</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center;">${lock.page_no}</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center;">${lock.heap_no}</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center;">
                        <span class="lock-type-badge" style="padding: 4px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold; 
                              background: ${lock.lock_type === 'X' ? '#dc3545' : lock.lock_type === 'S' ? '#17a2b8' : '#6c757d'}; 
                              color: white;">${lock.lock_type}</span>
                    </td>
                    <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center;">${lock.trx_id || '-'}</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center;">
                        <span style="color: ${lock.waiting ? '#e83e8c' : '#28a745'}; font-weight: bold;">
                            ${lock.waiting ? 'ç­‰å¾…ä¸­' : 'æŒæœ‰ä¸­'}
                        </span>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            table.appendChild(tbody);
            
            tableDiv.appendChild(table);
            container.appendChild(tableDiv);
        }

        // è·å–çŠ¶æ€æ–‡æœ¬
        function getStatusText(status) {
            const statusMap = {
                'active': 'æ‰§è¡Œä¸­',
                'completed': 'å·²å®Œæˆ',
                'blocked': 'è¢«é˜»å¡',
                'waiting': 'ç­‰å¾…ä¸­',
                'deadlock': 'æ­»é”æ£€æµ‹',
                'resolved': 'å·²è§£å†³'
            };
            return statusMap[status] || status;
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initDemo);
    </script>
</body>
</html>